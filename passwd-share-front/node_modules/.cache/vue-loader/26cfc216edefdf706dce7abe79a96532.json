{"remainingRequest":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/src/views/own-space/own-space.vue?vue&type=style&index=0&id=809e9776&lang=less&scoped=true&","dependencies":[{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/src/views/own-space/own-space.vue","mtime":1579164402593},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CkBpbXBvcnQgIi4vb3duLXNwYWNlLmxlc3MiOwo="},{"version":3,"sources":["own-space.vue"],"names":[],"mappings":";AACA","file":"own-space.vue","sourceRoot":"src/views/own-space","sourcesContent":["<style lang=\"less\" scoped>\n@import \"./own-space.less\";\n</style>\n\n<template>\n  <div class=\"own-space\">\n    <Card class=\"own-space-new\">\n      <div class=\"own-wrap\">\n        <div style=\"width:240px\">\n          <Menu :active-name=\"activeName\" theme=\"light\" @on-select=\"changeMenu\">\n            <MenuItem name=\"基本信息\">基本信息</MenuItem>\n            <MenuItem name=\"安全设置\">安全设置</MenuItem>\n            <MenuItem name=\"第三方账号绑定\">第三方账号绑定</MenuItem>\n            <MenuItem name=\"消息通知\">消息通知</MenuItem>\n          </Menu>\n        </div>\n        <div style=\"padding: 8px 40px;width:100%\">\n          <div class=\"title\">{{currMenu}}</div>\n          <div>\n            <div v-show=\"currMenu=='基本信息'\">\n              <Form ref=\"userForm\" :model=\"userForm\" :label-width=\"90\" label-position=\"left\">\n                <FormItem label=\"用户头像：\">\n                  <upload-pic-thumb\n                    @on-change=\"userForm.avatar=$event\"\n                    :multiple=\"false\"\n                    ref=\"uploadThumb\"\n                  ></upload-pic-thumb>\n                </FormItem>\n                <FormItem label=\"昵称：\" prop=\"nickName\">\n                  <Input v-model=\"userForm.nickName\" style=\"width: 250px\" />\n                </FormItem>\n                <FormItem label=\"性别：\">\n                  <RadioGroup v-model=\"userForm.sex\">\n                    <Radio v-for=\"(item, i) in dictSex\" :key=\"i\" :label=\"item.value\">{{item.title}}</Radio>\n                  </RadioGroup>\n                </FormItem>\n                <FormItem label=\"个人简介：\" prop=\"description\">\n                  <Input\n                    v-model=\"userForm.description\"\n                    type=\"textarea\"\n                    style=\"width: 250px\"\n                    :autosize=\"{minRows: 3,maxRows: 5}\"\n                    placeholder=\"个人简介\"\n                  ></Input>\n                </FormItem>\n                <FormItem label=\"国家/地区：\">\n                  <Select v-model=\"area\" style=\"width: 250px\">\n                    <Option :value=\"86\">中国</Option>\n                  </Select>\n                </FormItem>\n                <FormItem label=\"所在省市：\">\n                  <al-cascader\n                    v-model=\"userForm.addressArray\"\n                    @on-change=\"changeAddress\"\n                    data-type=\"code\"\n                    level=\"2\"\n                    style=\"width:250px\"\n                  />\n                </FormItem>\n                <FormItem label=\"街道地址：\" prop=\"street\">\n                  <Input v-model=\"userForm.street\" style=\"width: 250px\" />\n                </FormItem>\n                <FormItem label=\"所属部门：\">\n                  <span>{{ userForm.departmentTitle }}</span>\n                </FormItem>\n                <FormItem label=\"用户类型：\">\n                  <span>{{ userForm.typeTxt }}</span>\n                </FormItem>\n                <FormItem label=\"注册时间：\">\n                  <span>{{ userForm.createTime }}</span>\n                </FormItem>\n                <FormItem>\n                  <Button\n                    type=\"primary\"\n                    style=\"width: 100px;margin-right:5px\"\n                    :loading=\"saveLoading\"\n                    @click=\"saveEdit\"\n                  >保存</Button>\n                </FormItem>\n              </Form>\n            </div>\n            <div v-show=\"currMenu=='安全设置'\" class=\"safe\">\n              <div class=\"item\">\n                <div>\n                  <div class=\"title\">账户密码</div>\n                  <div v-if=\"userForm.passStrength\" class=\"desc\">\n                    当前密码强度：\n                    <span\n                      v-if=\"userForm.passStrength=='弱'\"\n                      class=\"red\"\n                    >{{userForm.passStrength}}</span>\n                    <span v-if=\"userForm.passStrength=='中'\" class=\"middle\">{{userForm.passStrength}}</span>\n                    <span v-if=\"userForm.passStrength=='强'\" class=\"green\">{{userForm.passStrength}}</span>\n                  </div>\n                </div>\n                <div>\n                  <a @click=\"changePass\">修改</a>\n                </div>\n              </div>\n              <div class=\"item\">\n                <div>\n                  <div class=\"title\">绑定手机</div>\n                  <div class=\"desc\">\n                    <span v-if=\"userForm.mobile\">已绑定手机：{{userForm.mobile}}</span>\n                    <span v-else>未绑定手机号</span>\n                  </div>\n                </div>\n                <div>\n                  <a @click=\"showChangeMobile\">修改</a>\n                </div>\n              </div>\n              <div class=\"item\">\n                <div>\n                  <div class=\"title\">绑定邮箱</div>\n                  <div class=\"desc\">\n                    <span v-if=\"userForm.email\">已绑定邮箱：{{userForm.email}}</span>\n                    <span v-else>未绑定邮箱</span>\n                  </div>\n                </div>\n                <div>\n                  <a @click=\"showChangeEmail\">修改</a>\n                </div>\n              </div>\n              <div class=\"item\">\n                <div>\n                  <div class=\"title\">密保问题</div>\n                  <div class=\"desc\">未设置密保问题，密保问题可有效保护账户安全</div>\n                </div>\n                <div>\n                  <a>暂不支持设置</a>\n                </div>\n              </div>\n            </div>\n            <div v-show=\"currMenu=='第三方账号绑定'\" class=\"safe\">\n              <div class=\"item\">\n                <div style=\"display:flex;align-items:center\">\n                  <Icon type=\"logo-github\" size=\"42\" color=\"#181617\" style=\"margin-right: 16px;\" />\n                  <div>\n                    <div class=\"title\">Github</div>\n                    <div class=\"desc\">\n                      <span v-if=\"github.related\">已绑定Github账号：{{github.username}}</span>\n                      <span v-else>当前未绑定Github账号</span>\n                    </div>\n                  </div>\n                </div>\n                <div>\n                  <a v-if=\"!github.related\" @click=\"toRelateGithub()\">立即绑定</a>\n                  <a v-else @click=\"unRelateGithub()\">解除绑定</a>\n                </div>\n              </div>\n              <div class=\"item\">\n                <div style=\"display:flex;align-items:center\">\n                  <icon name=\"brands/qq\" scale=\"2.5\" style=\"margin: 0 16px 0 6px;color:#2eabff\"></icon>\n                  <div>\n                    <div class=\"title\">QQ</div>\n                    <div class=\"desc\">\n                      <span v-if=\"qq.related\">已绑定QQ账号：{{qq.username}}</span>\n                      <span v-else>当前未绑定QQ账号</span>\n                    </div>\n                  </div>\n                </div>\n                <div>\n                  <a v-if=\"!qq.related\" @click=\"toRelateQQ()\">立即绑定</a>\n                  <a v-else @click=\"unRelateQQ()\">解除绑定</a>\n                </div>\n              </div>\n              <div class=\"item\">\n                <div style=\"display:flex;align-items:center\">\n                  <icon name=\"brands/weibo\" scale=\"2.5\" style=\"margin: 0 16px 0 2px;color:#e22429\"></icon>\n                  <div>\n                    <div class=\"title\">微博</div>\n                    <div class=\"desc\">\n                      <span v-if=\"weibo.related\">已绑定微博账号：{{weibo.username}}</span>\n                      <span v-else>当前未绑定微博账号</span>\n                    </div>\n                  </div>\n                </div>\n                <div>\n                  <a v-if=\"!weibo.related\" @click=\"toRelateWeibo()\">立即绑定</a>\n                  <a v-else @click=\"unRelateWeibo()\">解除绑定</a>\n                </div>\n              </div>\n              <div class=\"item\">\n                <div style=\"display:flex;align-items:center\">\n                  <icon name=\"brands/weixin\" scale=\"2.5\" style=\"margin: 0 16px 0 2px;color:#60c126\"></icon>\n                  <div>\n                    <div class=\"title\">微信</div>\n                    <div class=\"desc\">\n                      <span v-if=\"wechat.related\">已绑定微信账号：{{wechat.username}}</span>\n                      <span v-else>当前未绑定微信账号</span>\n                    </div>\n                  </div>\n                </div>\n                <div>\n                  <a v-if=\"!wechat.related\" @click=\"toRelateWechat()\">立即绑定</a>\n                  <a v-else @click=\"unRelateWechat()\">解除绑定</a>\n                </div>\n              </div>\n              <Spin fix v-if=\"jumping\">跳转中...</Spin>\n            </div>\n            <div v-show=\"currMenu=='消息通知'\" class=\"safe\">\n              <div class=\"item\">\n                <div>\n                  <div class=\"title\">系统消息</div>\n                  <div class=\"desc\">系统消息将以站内信的形式通知</div>\n                </div>\n                <div>\n                  <i-switch\n                    v-model=\"messageOpen\"\n                    @on-change=\"changeMessage\"\n                    :true-value=\"1\"\n                    :false-value=\"0\"\n                  >\n                    <span slot=\"open\">开</span>\n                    <span slot=\"close\">关</span>\n                  </i-switch>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </Card>\n\n    <Modal\n      title=\"修改手机号\"\n      v-model=\"editMobileVisible\"\n      :closable=\"false\"\n      :mask-closable=\"false\"\n      :width=\"500\"\n    >\n      <Form\n        ref=\"mobileEditForm\"\n        :model=\"mobileEditForm\"\n        :label-width=\"70\"\n        :rules=\"mobileEditValidate\"\n      >\n        <FormItem label=\"手机号\" prop=\"mobile\">\n          <Input v-model=\"mobileEditForm.mobile\" @on-change=\"hasChangePhone\" placeholder=\"请输入新手机号\" />\n        </FormItem>\n        <FormItem label=\"验证码\" prop=\"code\" :error=\"codeError\">\n          <Row type=\"flex\" justify=\"space-between\">\n            <Input v-model=\"mobileEditForm.code\" placeholder=\"请输入您收到的短信验证码\" style=\"width:280px;\" />\n            <CountDownButton\n              ref=\"countDownMobile\"\n              @on-click=\"sendEditMobileCode\"\n              :disabled=\"canSendMobileCode\"\n              :autoCountDown=\"false\"\n              :loading=\"sending\"\n              :text=\"getSms\"\n            />\n          </Row>\n        </FormItem>\n      </Form>\n      <div slot=\"footer\">\n        <Button type=\"text\" @click=\"cancelInputCodeBox\">取消</Button>\n        <Button type=\"primary\" :loading=\"checkCodeLoading\" @click=\"submitEditMobile\">提交</Button>\n      </div>\n    </Modal>\n\n    <Modal\n      title=\"修改邮箱\"\n      v-model=\"editEmailVisible\"\n      :closable=\"false\"\n      :mask-closable=\"false\"\n      :width=\"500\"\n    >\n      <Form\n        ref=\"emailEditForm\"\n        :model=\"emailEditForm\"\n        :label-width=\"100\"\n        :rules=\"emailEditValidate\"\n      >\n        <FormItem label=\"新邮箱地址\" prop=\"email\">\n          <Input v-model=\"emailEditForm.email\" @on-change=\"hasChangeEmail\" placeholder=\"请输入新邮箱地址\"></Input>\n        </FormItem>\n        <FormItem label=\"验证码\" prop=\"code\" :error=\"codeError\">\n          <Row type=\"flex\" justify=\"space-between\">\n            <Input v-model=\"emailEditForm.code\" placeholder=\"请输入您收到的邮件中的验证码\" style=\"width:250px;\" />\n            <CountDownButton\n              ref=\"countDownEmail\"\n              @on-click=\"sendVerifyEmail\"\n              :disabled=\"canSendEditEmail\"\n              :autoCountDown=\"false\"\n              :loading=\"sending\"\n              :text=\"getSms\"\n            />\n          </Row>\n        </FormItem>\n      </Form>\n      <div slot=\"footer\">\n        <Button type=\"text\" @click=\"cancelEditEmail\">取消</Button>\n        <Button type=\"primary\" :loading=\"editEmailLoading\" @click=\"submitEditEmail\">提交</Button>\n      </div>\n    </Modal>\n\n    <check-password ref=\"checkPassMobile\" @on-success=\"checkSuccessMobile\" />\n\n    <check-password ref=\"checkPassEmail\" @on-success=\"checkSuccessEmail\" />\n  </div>\n</template>\n\n<script>\nimport {\n  userInfo,\n  userInfoEdit,\n  relatedInfo,\n  unRelate,\n  githubLogin,\n  qqLogin,\n  weiboLogin,\n  wechatLogin,\n  sendEditEmail,\n  editEmail,\n  sendEditMobileSms,\n  changeMobile\n} from \"@/api/index\";\nimport { validateMobile } from \"@/libs/validate\";\nimport CountDownButton from \"@/views/my-components/share/count-down-button\";\nimport uploadPicThumb from \"@/views/my-components/share/upload-pic-thumb\";\nimport checkPassword from \"@/views/my-components/share/check-password\";\nimport Cookies from \"js-cookie\";\nimport messageVue from \"../message/message.vue\";\nexport default {\n  components: {\n    uploadPicThumb,\n    checkPassword,\n    CountDownButton\n  },\n  name: \"ownspace_index\",\n  data() {\n    return {\n      activeName: \"基本信息\",\n      area: 86,\n      messageOpen: 1,\n      userForm: {\n        id: \"\",\n        avatar: \"\",\n        username: \"\",\n        sex: \"\",\n        mobile: \"\",\n        email: \"\",\n        status: \"\",\n        type: \"\",\n        typeTxt: \"\",\n        address: \"\",\n        addressArray: []\n      },\n      mobileEditForm: {\n        mobile: \"\",\n        code: \"\"\n      },\n      emailEditForm: {\n        email: \"\",\n        code: \"\"\n      },\n      codeError: \"\",\n      initPhone: \"\",\n      initEmail: \"\",\n      saveLoading: false,\n      sending: false,\n      getSms: \"获取验证码\",\n      canSendMobileCode: false, // 是否可点获取验证码\n      checkCodeLoading: false,\n      checkPassLoading: false,\n      editEmailLoading: false,\n      mobileEditValidate: {\n        mobile: [\n          { required: true, message: \"请输入手机号码\" },\n          { validator: validateMobile }\n        ]\n      },\n      emailEditValidate: {\n        email: [\n          { required: true, message: \"请输入邮箱地址\" },\n          { type: \"email\", message: \"邮箱格式不正确\" }\n        ]\n      },\n      editMobileVisible: false, // 显示填写验证码box\n      editEmailVisible: false,\n      canSendEditEmail: false,\n      github: {\n        related: false,\n        id: \"\",\n        username: \"\"\n      },\n      qq: {\n        related: false,\n        id: \"\",\n        username: \"\"\n      },\n      weibo: {\n        related: false,\n        id: \"\",\n        username: \"\"\n      },\n      wechat: {\n        related: false,\n        id: \"\",\n        username: \"\"\n      },\n      jumping: false,\n      currMenu: \"基本信息\",\n      dictSex: this.$store.state.dict.sex\n    };\n  },\n  methods: {\n    init() {\n      let v = JSON.parse(Cookies.get(\"userInfo\"));\n      // 转换null为\"\"\n      for (let attr in v) {\n        if (v[attr] == null) {\n          v[attr] = \"\";\n        }\n      }\n      let str = JSON.stringify(v);\n      let userInfo = JSON.parse(str);\n      userInfo.addressArray = [];\n      this.userForm = userInfo;\n      this.initPhone = userInfo.mobile;\n      this.mobileEditForm.mobile = userInfo.mobile;\n      this.initEmail = userInfo.email;\n      this.emailEditForm.email = userInfo.email;\n      this.$refs.uploadThumb.setData(userInfo.avatar);\n      if (userInfo.address) {\n        this.userForm.address = userInfo.address;\n        this.userForm.addressArray = JSON.parse(userInfo.address);\n      }\n      if (this.userForm.type == 0) {\n        this.userForm.typeTxt = \"普通用户\";\n      } else if (this.userForm.type == 1) {\n        this.userForm.typeTxt = \"管理员\";\n      }\n      relatedInfo(userInfo.username).then(res => {\n        if (res.success) {\n          let r = res.result;\n          this.github.related = r.github;\n          this.github.id = r.githubId;\n          this.github.username = r.githubUsername;\n          this.qq.related = r.qq;\n          this.qq.id = r.qqId;\n          this.qq.username = r.qqUsername;\n          this.weibo.related = r.weibo;\n          this.weibo.id = r.weiboId;\n          this.weibo.username = r.weiboUsername;\n          this.wechat.related = r.wechat;\n          this.wechat.id = r.wechatId;\n          this.wechat.username = r.wechatUsername;\n        } else {\n          this.$Message.error(\"加载绑定第三方账号信息失败\");\n        }\n      });\n      let messageOpen = this.getStore(\"messageOpen\");\n      if (\n        messageOpen != \"\" &&\n        messageOpen != undefined &&\n        messageOpen != null\n      ) {\n        this.messageOpen = Number(messageOpen);\n      } else {\n        this.setStore(\"messageOpen\", 1);\n      }\n    },\n    changePass() {\n      this.$router.push({\n        name: \"change_pass\"\n      });\n    },\n    changeMenu(v) {\n      this.currMenu = v;\n    },\n    toRelateGithub() {\n      this.jumping = true;\n      githubLogin().then(res => {\n        if (res.success) {\n          window.location.href = res.result;\n        } else {\n          this.jumping = false;\n        }\n      });\n    },\n    toRelateQQ() {\n      this.jumping = true;\n      qqLogin().then(res => {\n        if (res.success) {\n          window.location.href = res.result;\n        } else {\n          this.jumping = false;\n        }\n      });\n    },\n    toRelateWeibo() {\n      this.jumping = true;\n      weiboLogin().then(res => {\n        if (res.success) {\n          window.location.href = res.result;\n        } else {\n          this.jumping = false;\n        }\n      });\n    },\n    toRelateWechat() {\n      this.jumping = true;\n      wechatLogin().then(res => {\n        if (res.success) {\n          window.location.href = res.result;\n        } else {\n          this.jumping = false;\n        }\n      });\n    },\n    unRelateGithub() {\n      this.$Modal.confirm({\n        title: \"确认解绑Github账号\",\n        content: \"您确认要解除绑定 \" + this.github.username + \" ?\",\n        loading: true,\n        onOk: () => {\n          let params = {\n            socialType: 0,\n            ids: [this.github.id],\n            usernames: this.userForm.username\n          };\n          unRelate(params).then(res => {\n            this.$Modal.remove();\n            if (res.success) {\n              this.$Message.success(\"操作成功\");\n              this.github.related = false;\n            }\n          });\n        }\n      });\n    },\n    unRelateQQ() {\n      this.$Modal.confirm({\n        title: \"确认解绑QQ账号\",\n        content: \"您确认要解除绑定 \" + this.qq.username + \" ?\",\n        loading: true,\n        onOk: () => {\n          let params = {\n            socialType: 1,\n            ids: [this.qq.id],\n            usernames: this.userForm.username\n          };\n          unRelate(params).then(res => {\n            this.$Modal.remove();\n            if (res.success) {\n              this.$Message.success(\"操作成功\");\n              this.qq.related = false;\n            }\n          });\n        }\n      });\n    },\n    unRelateWeibo() {\n      this.$Modal.confirm({\n        title: \"确认解绑微博账号\",\n        content: \"您确认要解除绑定 \" + this.weibo.username + \" ?\",\n        loading: true,\n        onOk: () => {\n          let params = {\n            socialType: 2,\n            ids: [this.weibo.id],\n            usernames: this.userForm.username\n          };\n          unRelate(params).then(res => {\n            this.$Modal.remove();\n            if (res.success) {\n              this.$Message.success(\"操作成功\");\n              this.weibo.related = false;\n            }\n          });\n        }\n      });\n    },\n    unRelateWechat() {\n      this.$Modal.confirm({\n        title: \"确认解绑微信账号\",\n        content: \"您确认要解除绑定 \" + this.wechat.username + \" ?\",\n        loading: true,\n        onOk: () => {\n          let params = {\n            socialType: 3,\n            ids: [this.wechat.id],\n            usernames: this.userForm.username\n          };\n          unRelate(params).then(res => {\n            this.$Modal.remove();\n            if (res.success) {\n              this.$Message.success(\"操作成功\");\n              this.wechat.related = false;\n            }\n          });\n        }\n      });\n    },\n    showChangeMobile() {\n      this.$refs.checkPassMobile.show();\n    },\n    checkSuccessMobile() {\n      this.editMobileVisible = true;\n    },\n    showChangeEmail() {\n      this.$refs.checkPassEmail.show();\n    },\n    checkSuccessEmail() {\n      this.editEmailVisible = true;\n    },\n    saveEdit() {\n      this.saveLoading = true;\n      let params = this.userForm;\n      userInfoEdit(params).then(res => {\n        this.saveLoading = false;\n        if (res.success) {\n          this.$Message.success(\"保存成功\");\n          // 更新用户信息\n          Cookies.set(\"userInfo\", this.userForm);\n          // 更新头像\n          this.$store.commit(\"setAvatarPath\", this.userForm.avatar);\n        }\n      });\n    },\n    changeAddress() {\n      this.userForm.address = JSON.stringify(this.userForm.addressArray);\n    },\n    cancelInputCodeBox() {\n      this.editMobileVisible = false;\n      this.userForm.mobile = this.initPhone;\n    },\n    cancelEditEmail() {\n      this.editEmailVisible = false;\n      this.emailEditForm.email = this.initEmail;\n    },\n    sendEditMobileCode() {\n      this.$refs[\"mobileEditForm\"].validate(valid => {\n        if (valid) {\n          this.getSms = \"发送中\";\n          this.sending = true;\n          sendEditMobileSms(this.mobileEditForm.mobile).then(res => {\n            this.getSms = \"获取验证码\";\n            this.sending = false;\n            if (res.success) {\n              this.$Message.success(\"发送短信验证码成功\");\n              // 开始倒计时\n              this.$refs.countDownMobile.startCountDown();\n            }\n          });\n        }\n      });\n    },\n    submitEditMobile() {\n      this.$refs[\"mobileEditForm\"].validate(valid => {\n        if (valid) {\n          if (!this.mobileEditForm.code) {\n            this.codeError = \"请填写短信验证码\";\n            return;\n          } else {\n            this.codeError = \"\";\n          }\n          this.checkCodeLoading = true;\n          changeMobile(this.mobileEditForm).then(res => {\n            this.checkCodeLoading = false;\n            if (res.success) {\n              this.$Message.success(\"修改成功\");\n              this.userForm.mobile = this.mobileEditForm.mobile;\n              this.initPhone = this.mobileEditForm.mobile;\n              this.updateUserInfo();\n              this.editMobileVisible = false;\n            }\n          });\n        }\n      });\n    },\n    hasChangePhone() {\n      if (this.mobileEditForm.mobile == this.initPhone) {\n        this.canSendMobileCode = true;\n      } else {\n        this.$refs[\"mobileEditForm\"].validate(valid => {\n          if (valid) {\n            this.canSendMobileCode = false;\n          } else {\n            this.canSendMobileCode = true;\n          }\n        });\n      }\n    },\n    hasChangeEmail() {\n      if (this.emailEditForm.email == this.initEmail) {\n        this.canSendEditEmail = true;\n      } else {\n        this.canSendEditEmail = false;\n      }\n    },\n    sendVerifyEmail() {\n      this.$refs[\"emailEditForm\"].validate(valid => {\n        if (valid) {\n          this.getSms = \"发送中\";\n          this.sending = true;\n          sendEditEmail(this.emailEditForm.email).then(res => {\n            this.getSms = \"获取验证码\";\n            this.sending = false;\n            if (res.success) {\n              this.$Message.success(\"发送邮件验证码成功，请注意查收\");\n              // 开始倒计时\n              this.$refs.countDownEmail.startCountDown();\n            }\n          });\n        }\n      });\n    },\n    submitEditEmail() {\n      this.$refs[\"emailEditForm\"].validate(valid => {\n        if (valid) {\n          if (!this.emailEditForm.code) {\n            this.codeError = \"验证码不能为空\";\n            return;\n          } else {\n            this.codeError = \"\";\n          }\n          this.editEmailLoading = true;\n          editEmail(this.emailEditForm).then(res => {\n            this.editEmailLoading = false;\n            if (res.success) {\n              this.initEmail = this.emailEditForm.email;\n              this.userForm.email = this.emailEditForm.email;\n              this.updateUserInfo();\n              this.$Message.success(\"修改邮件成功\");\n              this.editEmailVisible = false;\n            }\n          });\n        }\n      });\n    },\n    updateUserInfo() {\n      // 更新用户信息\n      userInfo().then(res => {\n        if (res.success) {\n          // 避免超过大小限制\n          delete res.result.permissions;\n          if (this.getStore(\"saveLogin\")) {\n            // 保存7天\n            Cookies.set(\"userInfo\", JSON.stringify(res.result), {\n              expires: 7\n            });\n          } else {\n            Cookies.set(\"userInfo\", JSON.stringify(res.result));\n          }\n          this.setStore(\"userInfo\", res.result);\n        }\n      });\n    },\n    changeMessage(v) {\n      this.setStore(\"messageOpen\", v);\n    }\n  },\n  mounted() {\n    let type = this.$route.query.type;\n    if (type == \"social\") {\n      this.activeName = \"第三方账号绑定\";\n      this.currMenu = \"第三方账号绑定\";\n    }\n    this.init();\n  }\n};\n</script>\n"]}]}