{"remainingRequest":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/src/views/activiti/apply-manage/applyManage.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/src/views/activiti/apply-manage/applyManage.vue","mtime":1577168504899},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CkBpbXBvcnQgIi4uLy4uLy4uL3N0eWxlcy90YWJsZS1jb21tb24ubGVzcyI7CkBpbXBvcnQgIi4vYXBwbHlNYW5hZ2UubGVzcyI7Cg=="},{"version":3,"sources":["applyManage.vue"],"names":[],"mappings":";AACA;AACA","file":"applyManage.vue","sourceRoot":"src/views/activiti/apply-manage","sourcesContent":["<style lang=\"less\">\n@import \"../../../styles/table-common.less\";\n@import \"./applyManage.less\";\n</style>\n<template>\n  <div class=\"search\">\n    <Card>\n      <Row v-show=\"openSearch\" @keydown.enter.native=\"handleSearch\">\n        <Form ref=\"searchForm\" :model=\"searchForm\" inline :label-width=\"70\">\n          <Form-item label=\"标题\" prop=\"title\">\n            <Input\n              type=\"text\"\n              v-model=\"searchForm.title\"\n              placeholder=\"请输入\"\n              clearable\n              style=\"width: 200px\"\n            />\n          </Form-item>\n          <Form-item label=\"状态\" prop=\"status\">\n            <Select v-model=\"searchForm.status\" placeholder=\"请选择\" clearable style=\"width: 200px\">\n              <Option value=\"0\">草稿</Option>\n              <Option value=\"1\">处理中</Option>\n              <Option value=\"2\">已结束</Option>\n              <Option value=\"3\">已撤回</Option>\n            </Select>\n          </Form-item>\n          <span v-if=\"drop\">\n            <Form-item label=\"结果\" prop=\"result\">\n              <Select v-model=\"searchForm.result\" placeholder=\"请选择\" clearable style=\"width: 200px\">\n                <Option value=\"0\">未提交</Option>\n                <Option value=\"1\">处理中</Option>\n                <Option value=\"2\">通过</Option>\n                <Option value=\"3\">驳回</Option>\n              </Select>\n            </Form-item>\n            <Form-item label=\"创建时间\">\n              <DatePicker\n                v-model=\"selectDate\"\n                type=\"daterange\"\n                format=\"yyyy-MM-dd\"\n                clearable\n                @on-change=\"selectDateRange\"\n                placeholder=\"选择起始时间\"\n                style=\"width: 200px\"\n              ></DatePicker>\n            </Form-item>\n          </span>\n          <Form-item style=\"margin-left:-35px;\" class=\"br\">\n            <Button @click=\"handleSearch\" type=\"primary\" icon=\"ios-search\">搜索</Button>\n            <Button @click=\"handleReset\">重置</Button>\n            <a class=\"drop-down\" @click=\"dropDown\">\n              {{dropDownContent}}\n              <Icon :type=\"dropDownIcon\"></Icon>\n            </a>\n          </Form-item>\n        </Form>\n      </Row>\n      <Row class=\"operation\">\n        <Button @click=\"add\" type=\"primary\" icon=\"md-add\">新增申请</Button>\n        <Button @click=\"delAll\" icon=\"md-trash\">批量删除</Button>\n        <Button @click=\"getDataList\" icon=\"md-refresh\">刷新</Button>\n        <Button type=\"dashed\" @click=\"openSearch=!openSearch\">{{openSearch ? \"关闭搜索\" : \"开启搜索\"}}</Button>\n        <Button type=\"dashed\" @click=\"openTip=!openTip\">{{openTip ? \"关闭提示\" : \"开启提示\"}}</Button>\n      </Row>\n      <Row v-show=\"openTip\">\n        <Alert show-icon>\n          已选择\n          <span class=\"select-count\">{{selectCount}}</span> 项\n          <a class=\"select-clear\" @click=\"clearSelectAll\">清空</a>\n        </Alert>\n      </Row>\n      <Row>\n        <Table\n          :loading=\"loading\"\n          border\n          :columns=\"columns\"\n          :data=\"data\"\n          sortable=\"custom\"\n          @on-sort-change=\"changeSort\"\n          @on-selection-change=\"showSelect\"\n          ref=\"table\"\n        ></Table>\n      </Row>\n      <Row type=\"flex\" justify=\"end\" class=\"page\">\n        <Page\n          :current=\"searchForm.pageNumber\"\n          :total=\"total\"\n          :page-size=\"searchForm.pageSize\"\n          @on-change=\"changePage\"\n          @on-page-size-change=\"changePageSize\"\n          :page-size-opts=\"[10,20,50]\"\n          size=\"small\"\n          show-total\n          show-elevator\n          show-sizer\n        ></Page>\n      </Row>\n    </Card>\n\n    <!-- Drawer抽屉式选择流程 -->\n    <Drawer title=\"选择流程\" closable v-model=\"processModalVisible\" width=\"800\" draggable>\n      <div class=\"apply-operation\">\n        <div>\n          <Form\n            ref=\"searchProcessForm\"\n            :model=\"searchProcessForm\"\n            inline\n            :label-width=\"70\"\n           \n          >\n            <Form-item label=\"流程名称\" prop=\"name\">\n              <Input\n                type=\"text\"\n                v-model=\"searchProcessForm.name\"\n                clearable\n                placeholder=\"请输入流程名\"\n                style=\"width: 140px\"\n              />\n            </Form-item>\n            <Form-item label=\"所属分类\" prop=\"category\">\n              <Cascader\n                v-model=\"selectCat\"\n                :data=\"category\"\n                :load-data=\"loadData\"\n                @on-change=\"handleChangeCat\"\n                change-on-select\n                filterable\n                clearable\n                placeholder=\"请选择分类\"\n                style=\"width: 140px\"\n              ></Cascader>\n            </Form-item>\n            <Form-item style=\"margin-left:-70px;\" class=\"br\">\n              <Button @click=\"getProcessList\" type=\"primary\" icon=\"ios-search\">搜索</Button>\n              <Button @click=\"handleResetProcess\">重置</Button>\n              <i-switch\n                size=\"large\"\n                v-model=\"searchProcessForm.showLatest\"\n                @on-change=\"getProcessList\"\n                style=\"margin:0 5px\"\n              >\n                <span slot=\"open\">最新</span>\n                <span slot=\"close\">全部</span>\n              </i-switch>\n            </Form-item>\n          </Form>\n        </div>\n        <div>\n          <RadioGroup v-model=\"showType\" type=\"button\">\n            <Radio title=\"缩略图\" label=\"thumb\">\n              <Icon type=\"ios-apps\"></Icon>\n            </Radio>\n            <Radio title=\"列表\" label=\"list\">\n              <Icon type=\"md-list\"></Icon>\n            </Radio>\n          </RadioGroup>\n        </div>\n      </div>\n      <div class=\"process-wrapper\" v-if=\"showType=='thumb'\">\n        <Card v-for=\"(item, i) in processData\" :key=\"i\" class=\"process-card\">\n          <div class=\"content\" @click=\"chooseProcess(item)\">\n            <div class=\"other\">\n              <div class=\"name\">{{i+1}}. {{item.name}}</div>\n              <div class=\"key\">{{item.description}}</div>\n              <div class=\"info\">版本：v.{{item.version}} 所属分类：{{item.categoryTitle}}</div>\n            </div>\n          </div>\n        </Card>\n        <Spin fix v-if=\"processLoading\" />\n      </div>\n      <Table\n        :loading=\"processLoading\"\n        border\n        :columns=\"processColumns\"\n        :data=\"processData\"\n        ref=\"processTable\"\n        v-if=\"showType=='list'\"\n      ></Table>\n    </Drawer>\n\n    <Modal title=\"提交申请\" v-model=\"modalVisible\" :mask-closable=\"false\" :width=\"500\">\n      <Form ref=\"form\" :model=\"form\" :label-width=\"85\" :rules=\"formValidate\">\n        <FormItem label=\"选择审批人\" prop=\"assignees\" :error=\"error\">\n          <Select\n            v-model=\"form.assignees\"\n            placeholder=\"请选择或输入搜索\"\n            filterable\n            clearable\n            multiple\n            :loading=\"userLoading\"\n          >\n            <Option v-for=\"(item, i) in assigneeList\" :key=\"i\" :value=\"item.id\">{{item.username}}</Option>\n          </Select>\n        </FormItem>\n        <FormItem label=\"优先级\" prop=\"priority\">\n          <Select v-model=\"form.priority\" placeholder=\"请选择\" clearable>\n            <Option v-for=\"(item, i) in dictPriority\" :key=\"i\" :value=\"item.value\">{{item.title}}</Option>\n          </Select>\n        </FormItem>\n        <FormItem label=\"消息通知\">\n          <Checkbox v-model=\"form.sendMessage\">站内消息通知</Checkbox>\n          <Checkbox v-model=\"form.sendSms\">短信通知</Checkbox>\n          <Checkbox v-model=\"form.sendEmail\">邮件通知</Checkbox>\n        </FormItem>\n      </Form>\n      <div slot=\"footer\">\n        <Button type=\"text\" @click=\"handelCancel\">取消</Button>\n        <Button type=\"primary\" :loading=\"submitLoading\" @click=\"handelSubmit\">提交</Button>\n      </div>\n    </Modal>\n\n    <Modal title=\"确认撤回\" v-model=\"modalCancelVisible\" :mask-closable=\"false\" :width=\"500\">\n      <Form ref=\"delForm\" v-model=\"cancelForm\" :label-width=\"70\">\n        <FormItem label=\"撤回原因\" prop=\"reason\">\n          <Input type=\"textarea\" v-model=\"cancelForm.reason\" :rows=\"4\" />\n        </FormItem>\n      </Form>\n      <div slot=\"footer\">\n        <Button type=\"text\" @click=\"modalCancelVisible=false\">取消</Button>\n        <Button type=\"primary\" :loading=\"submitLoading\" @click=\"handelSubmitCancel\">提交</Button>\n      </div>\n    </Modal>\n  </div>\n</template>\n\n<script>\nimport {\n  getProcessDataList,\n  getFirstNode,\n  getBusinessDataList,\n  applyBusiness,\n  deleteBusiness,\n  cancelApply,\n  initActCategory,\n  loadActCategory\n} from \"@/api/activiti\";\nexport default {\n  name: \"apply-manage\",\n  data() {\n    return {\n      openSearch: true,\n      openTip: true,\n      loading: true, // 表单加载状态\n      processModalVisible: false,\n      selectCat: [],\n      category: [],\n      error: \"\",\n      searchProcessForm: {\n        showLatest: true,\n        name: \"\",\n        status: \"1\", // 激活状态\n        pageNumber: 1, // 当前页数\n        pageSize: 1000, // 页面大小\n        sort: \"createTime\", // 默认排序字段\n        order: \"desc\" // 默认排序方式\n      },\n      cancelForm: {\n        reason: \"\"\n      },\n      modalCancelVisible: false,\n      processLoading: false,\n      processColumns: [\n        {\n          type: \"index\",\n          width: 60,\n          align: \"center\"\n        },\n        {\n          title: \"名称\",\n          key: \"name\",\n          width: 150,\n          sortable: true\n        },\n        {\n          title: \"备注描述\",\n          key: \"description\",\n          width: 150,\n          sortable: true\n        },\n        {\n          title: \"所属分类\",\n          key: \"categoryTitle\",\n          width: 150,\n          sortable: true\n        },\n        {\n          title: \"版本\",\n          key: \"version\",\n          align: \"center\",\n          sortable: true,\n          render: (h, params) => {\n            let re = \"\";\n            if (params.row.version) {\n              re = \"v.\" + params.row.version;\n            }\n            return h(\"div\", re);\n          }\n        },\n        {\n          title: \"操作\",\n          key: \"action\",\n          width: 135,\n          align: \"center\",\n          fixed: \"right\",\n          render: (h, params) => {\n            return h(\"div\", [\n              h(\n                \"Button\",\n                {\n                  props: {\n                    type: \"info\",\n                    size: \"small\"\n                  },\n                  on: {\n                    click: () => {\n                      this.chooseProcess(params.row);\n                    }\n                  }\n                },\n                \"选择该流程\"\n              )\n            ]);\n          }\n        }\n      ],\n      processData: [],\n      showType: \"thumb\",\n      selectCount: 0, // 多选计数\n      selectList: [], // 多选数据\n      drop: false, // 搜索展开标识\n      dropDownContent: \"展开\", // 搜索展开标识文字\n      dropDownIcon: \"ios-arrow-down\", //搜索展开图标\n      searchForm: {\n        // 搜索框对应data对象\n        title: \"\",\n        status: \"\",\n        result: \"\",\n        pageNumber: 1, // 当前页数\n        pageSize: 10, // 页面大小\n        startDate: \"\",\n        endDate: \"\",\n        sort: \"createTime\", // 默认排序字段\n        order: \"desc\" // 默认排序方式\n      },\n      userLoading: false,\n      modalVisible: false, // 添加或编辑显示\n      selectDate: null,\n      form: {\n        sendMessage: true,\n        sendSms: true,\n        sendEmail: true,\n        procDefId: \"\",\n        assignees: [],\n        priority: \"0\"\n      },\n      formValidate: {\n        // 表单验证规则\n        procDefId: [{ required: true, message: \"不能为空\", trigger: \"blur\" }],\n        priority: [{ required: true, message: \"不能为空\", trigger: \"blur\" }]\n      },\n      submitLoading: false, // 添加或编辑提交状态\n      columns: [\n        // 表头\n        {\n          type: \"selection\",\n          width: 60,\n          align: \"center\"\n        },\n        {\n          type: \"index\",\n          width: 60,\n          align: \"center\"\n        },\n        {\n          title: \"标题\",\n          key: \"title\",\n          minWidth: 150,\n          sortable: true\n        },\n        {\n          title: \"所属流程\",\n          key: \"processName\",\n          width: 150,\n          tooltip: true\n        },\n        {\n          title: \"当前审批环节\",\n          key: \"currTaskName\",\n          width: 150,\n          tooltip: true\n        },\n        {\n          title: \"状态\",\n          key: \"status\",\n          align: \"center\",\n          width: 120,\n          sortable: true,\n          render: (h, params) => {\n            let text = \"未知\",\n              color = \"\";\n            if (params.row.status == 0) {\n              text = \"草稿\";\n              color = \"default\";\n            } else if (params.row.status == 1) {\n              text = \"处理中\";\n              color = \"orange\";\n            } else if (params.row.status == 2) {\n              text = \"已结束\";\n              color = \"blue\";\n            } else if (params.row.status == 3) {\n              text = \"已撤回\";\n              color = \"magenta\";\n            }\n            return h(\"div\", [\n              h(\n                \"Tag\",\n                {\n                  props: {\n                    color: color\n                  }\n                },\n                text\n              )\n            ]);\n          }\n        },\n        {\n          title: \"结果\",\n          key: \"result\",\n          align: \"center\",\n          width: 120,\n          sortable: true,\n          render: (h, params) => {\n            let text = \"未知\",\n              color = \"\";\n            if (params.row.result == 0) {\n              text = \"未提交\";\n              color = \"default\";\n            } else if (params.row.result == 1) {\n              text = \"处理中\";\n              color = \"orange\";\n            } else if (params.row.result == 2) {\n              text = \"已通过\";\n              color = \"green\";\n            } else if (params.row.result == 3) {\n              text = \"已驳回\";\n              color = \"red\";\n            }\n            return h(\"div\", [\n              h(\n                \"Tag\",\n                {\n                  props: {\n                    color: color\n                  }\n                },\n                text\n              )\n            ]);\n          }\n        },\n        {\n          title: \"创建时间\",\n          key: \"createTime\",\n          width: 180,\n          sortType: \"desc\",\n          sortable: true\n        },\n        {\n          title: \"提交申请时间\",\n          key: \"applyTime\",\n          width: 180,\n          sortable: true\n        },\n        {\n          title: \"操作\",\n          key: \"action\",\n          align: \"center\",\n          width: 265,\n          fixed: \"right\",\n          render: (h, params) => {\n            let re = \"\";\n            if (params.row.status == 0) {\n              re = [\n                h(\n                  \"Button\",\n                  {\n                    props: {\n                      type: \"primary\",\n                      size: \"small\"\n                    },\n                    style: {\n                      marginRight: \"5px\"\n                    },\n                    on: {\n                      click: () => {\n                        this.apply(params.row);\n                      }\n                    }\n                  },\n                  \"提交申请\"\n                ),\n                h(\n                  \"Button\",\n                  {\n                    props: {\n                      size: \"small\"\n                    },\n                    style: {\n                      marginRight: \"5px\"\n                    },\n                    on: {\n                      click: () => {\n                        this.edit(params.row);\n                      }\n                    }\n                  },\n                  \"编辑\"\n                ),\n                h(\n                  \"Button\",\n                  {\n                    props: {\n                      type: \"error\",\n                      size: \"small\"\n                    },\n                    on: {\n                      click: () => {\n                        this.remove(params.row);\n                      }\n                    }\n                  },\n                  \"删除\"\n                )\n              ];\n            } else if (params.row.status == 1) {\n              re = [\n                h(\n                  \"Button\",\n                  {\n                    props: {\n                      size: \"small\",\n                      type: \"warning\",\n                      icon: \"ios-redo\"\n                    },\n                    style: {\n                      marginRight: \"5px\"\n                    },\n                    on: {\n                      click: () => {\n                        this.cancel(params.row);\n                      }\n                    }\n                  },\n                  \"撤回\"\n                ),\n                h(\n                  \"Button\",\n                  {\n                    props: {\n                      size: \"small\",\n                      type: \"info\"\n                    },\n                    style: {\n                      marginRight: \"5px\"\n                    },\n                    on: {\n                      click: () => {\n                        this.history(params.row);\n                      }\n                    }\n                  },\n                  \"查看进度\"\n                ),\n                h(\n                  \"Button\",\n                  {\n                    props: {\n                      size: \"small\"\n                    },\n                    style: {\n                      marginRight: \"5px\"\n                    },\n                    on: {\n                      click: () => {\n                        this.detail(params.row);\n                      }\n                    }\n                  },\n                  \"表单数据\"\n                )\n              ];\n            } else if (\n              (params.row.status == 2 && params.row.result == 3) ||\n              params.row.status == 3\n            ) {\n              re = [\n                h(\n                  \"Button\",\n                  {\n                    props: {\n                      type: \"primary\",\n                      size: \"small\"\n                    },\n                    style: {\n                      marginRight: \"5px\"\n                    },\n                    on: {\n                      click: () => {\n                        this.apply(params.row);\n                      }\n                    }\n                  },\n                  \"重新申请\"\n                ),\n                h(\n                  \"Button\",\n                  {\n                    props: {\n                      size: \"small\"\n                    },\n                    style: {\n                      marginRight: \"5px\"\n                    },\n                    on: {\n                      click: () => {\n                        this.edit(params.row);\n                      }\n                    }\n                  },\n                  \"编辑\"\n                ),\n                h(\n                  \"Button\",\n                  {\n                    props: {\n                      size: \"small\",\n                      type: \"info\"\n                    },\n                    style: {\n                      marginRight: \"5px\"\n                    },\n                    on: {\n                      click: () => {\n                        this.history(params.row);\n                      }\n                    }\n                  },\n                  \"审批历史\"\n                )\n              ];\n            } else {\n              re = [\n                h(\n                  \"Button\",\n                  {\n                    props: {\n                      size: \"small\"\n                    },\n                    style: {\n                      marginRight: \"5px\"\n                    },\n                    on: {\n                      click: () => {\n                        this.detail(params.row);\n                      }\n                    }\n                  },\n                  \"表单数据\"\n                ),\n                h(\n                  \"Button\",\n                  {\n                    props: {\n                      size: \"small\",\n                      type: \"info\"\n                    },\n                    style: {\n                      marginRight: \"5px\"\n                    },\n                    on: {\n                      click: () => {\n                        this.history(params.row);\n                      }\n                    }\n                  },\n                  \"审批历史\"\n                )\n              ];\n            }\n\n            return h(\"div\", re);\n          }\n        }\n      ],\n      data: [], // 表单数据\n      total: 0, // 表单数据总数\n      assigneeList: [],\n      dictPriority: this.$store.state.dict.priority\n    };\n  },\n  methods: {\n    init() {\n      this.getDataList();\n      this.getProcessList();\n      this.initCategoryData();\n    },\n    getProcessList() {\n      this.processLoading = true;\n      getProcessDataList(this.searchProcessForm).then(res => {\n        this.processLoading = false;\n        if (res.success) {\n          this.processData = res.result.content;\n        }\n      });\n    },\n    initCategoryData() {\n      initActCategory().then(res => {\n        if (res.success) {\n          res.result.forEach(function(e) {\n            if (e.isParent) {\n              e.value = e.id;\n              e.label = e.title;\n              e.loading = false;\n              e.children = [];\n            } else {\n              e.value = e.id;\n              e.label = e.title;\n            }\n            if (e.status == -1) {\n              e.label = \"[已禁用] \" + e.label;\n              e.disabled = true;\n            }\n          });\n          this.category = res.result;\n        }\n      });\n    },\n    loadData(item, callback) {\n      item.loading = true;\n      loadActCategory(item.value).then(res => {\n        item.loading = false;\n        if (res.success) {\n          res.result.forEach(function(e) {\n            if (e.isParent) {\n              e.value = e.id;\n              e.label = e.title;\n              e.loading = false;\n              e.children = [];\n            } else {\n              e.value = e.id;\n              e.label = e.title;\n            }\n            if (e.status == -1) {\n              e.label = \"[已禁用] \" + e.label;\n              e.disabled = true;\n            }\n          });\n          item.children = res.result;\n          callback();\n        }\n      });\n    },\n    handleChangeCat(value, selectedData) {\n      let categoryId = \"\";\n      // 获取最后一个值\n      if (value && value.length > 0) {\n        categoryId = value[value.length - 1];\n      }\n      this.searchProcessForm.categoryId = categoryId;\n    },\n    dropDown() {\n      if (this.drop) {\n        this.dropDownContent = \"展开\";\n        this.dropDownIcon = \"ios-arrow-down\";\n      } else {\n        this.dropDownContent = \"收起\";\n        this.dropDownIcon = \"ios-arrow-up\";\n      }\n      this.drop = !this.drop;\n    },\n    handleResetProcess() {\n      this.$refs.searchProcessForm.resetFields();\n      // 重新加载数据\n      this.getProcessList();\n    },\n    changeSort(e) {\n      this.searchForm.sort = e.key;\n      this.searchForm.order = e.order;\n      if (e.order == \"normal\") {\n        this.searchForm.order = \"\";\n      }\n      this.getDataList();\n    },\n    changePage(v) {\n      this.searchForm.pageNumber = v;\n      this.getDataList();\n      this.clearSelectAll();\n    },\n    changePageSize(v) {\n      this.searchForm.pageSize = v;\n      this.getDataList();\n    },\n    selectDateRange(v) {\n      if (v) {\n        this.searchForm.startDate = v[0];\n        this.searchForm.endDate = v[1];\n      }\n    },\n    getDataList() {\n      this.loading = true;\n      // 避免后台默认值\n      if (!this.searchForm.status) {\n        this.searchForm.status = \"\";\n      }\n      if (!this.searchForm.result) {\n        this.searchForm.result = \"\";\n      }\n      getBusinessDataList(this.searchForm).then(res => {\n        this.loading = false;\n        if (res.success) {\n          this.data = res.result.content;\n          this.total = res.result.totalElements;\n        }\n      });\n    },\n    handleSearch() {\n      this.searchForm.pageNumber = 1;\n      this.searchForm.pageSize = 10;\n      this.getDataList();\n    },\n    handleReset() {\n      this.$refs.searchForm.resetFields();\n      this.searchForm.pageNumber = 1;\n      this.searchForm.pageSize = 10;\n      this.selectDate = null;\n      this.searchForm.startDate = \"\";\n      this.searchForm.endDate = \"\";\n      // 重新加载数据\n      this.getDataList();\n    },\n    handelCancel() {\n      this.modalVisible = false;\n    },\n    handelSubmit() {\n      this.$refs.form.validate(valid => {\n        if (valid) {\n          if (this.form.assignees.length < 1) {\n            this.error = \"请至少选择一个审批人\";\n            return;\n          } else {\n            this.error = \"\";\n          }\n          this.submitLoading = true;\n          applyBusiness(this.form).then(res => {\n            this.submitLoading = false;\n            if (res.success) {\n              this.$Message.success(\"操作成功\");\n              this.getDataList();\n              this.modalVisible = false;\n            }\n          });\n        }\n      });\n    },\n    add() {\n      this.processModalVisible = true;\n    },\n    chooseProcess(v) {\n      if (!v.routeName) {\n        this.$Message.warning(\n          \"该流程信息未完善，请于流程管理中编辑流程完善信息\"\n        );\n        return;\n      }\n      this.processModalVisible = false;\n      let query = { type: 0, backRoute: this.$route.name, procDefId: v.id };\n      this.$router.push({\n        name: v.routeName,\n        query: query\n      });\n    },\n    edit(v) {\n      if (!v.routeName) {\n        this.$Message.error(\"表单路由名为空\");\n        return;\n      }\n      let query = { type: 1, id: v.tableId, backRoute: this.$route.name };\n      this.$router.push({\n        name: v.routeName,\n        query: query\n      });\n    },\n    detail(v) {\n      if (!v.routeName) {\n        this.$Message.error(\"表单路由名为空\");\n        return;\n      }\n      let query = { type: 2, id: v.tableId, backRoute: this.$route.name };\n      this.$router.push({\n        name: v.routeName,\n        query: query\n      });\n    },\n    apply(v) {\n      if (!v.procDefId || v.procDefId == \"null\") {\n        this.$Message.error(\"流程定义为空\");\n        return;\n      }\n      this.form.id = v.id;\n      this.form.procDefId = v.procDefId;\n      this.form.title = v.title;\n      // 加载审批人\n      this.userLoading = true;\n      getFirstNode(v.procDefId).then(res => {\n        this.userLoading = false;\n        if (res.success) {\n          this.assigneeList = res.result.users;\n          // 默认勾选\n          let ids = [];\n          res.result.users.forEach(e => {\n            ids.push(e.id);\n          });\n          this.form.assignees = ids;\n        }\n      });\n      this.modalVisible = true;\n    },\n    cancel(v) {\n      this.cancelForm.id = v.id;\n      this.cancelForm.procInstId = v.procInstId;\n      this.modalCancelVisible = true;\n    },\n    handelSubmitCancel() {\n      this.submitLoading = true;\n      cancelApply(this.cancelForm).then(res => {\n        this.submitLoading = false;\n        if (res.success) {\n          this.$Message.success(\"操作成功\");\n          this.getDataList();\n          this.modalCancelVisible = false;\n        }\n      });\n    },\n    history(v) {\n      if (!v.procInstId) {\n        this.$Message.error(\"流程实例ID不存在\");\n        return;\n      }\n      let query = { id: v.procInstId, backRoute: this.$route.name };\n      this.$router.push({\n        name: \"historic_detail\",\n        query: query\n      });\n    },\n    remove(v) {\n      this.$Modal.confirm({\n        title: \"确认删除\",\n        // 记得确认修改此处\n        content: \"您确认要删除 \" + v.title + \" ?\",\n        loading: true,\n        onOk: () => {\n          // 删除\n          deleteBusiness(v.id).then(res => {\n            this.$Modal.remove();\n            if (res.success) {\n              this.$Message.success(\"操作成功\");\n              this.getDataList();\n            }\n          });\n        }\n      });\n    },\n    showSelect(e) {\n      this.selectList = e;\n      this.selectCount = e.length;\n    },\n    clearSelectAll() {\n      this.$refs.table.selectAll(false);\n    },\n    delAll() {\n      if (this.selectCount <= 0) {\n        this.$Message.warning(\"您还未选择要删除的数据\");\n        return;\n      }\n      this.$Modal.confirm({\n        title: \"确认删除\",\n        content: \"您确认要删除所选的 \" + this.selectCount + \" 条数据?\",\n        loading: true,\n        onOk: () => {\n          let ids = \"\";\n          this.selectList.forEach(function(e) {\n            ids += e.id + \",\";\n          });\n          ids = ids.substring(0, ids.length - 1);\n          // 批量删除\n          deleteBusiness(ids).then(res => {\n            this.$Modal.remove();\n            if (res.success) {\n              this.$Message.success(\"操作成功\");\n              this.clearSelectAll();\n              this.getDataList();\n            }\n          });\n        }\n      });\n    }\n  },\n  mounted() {\n    this.init();\n  },\n  watch: {\n    // 监听路由变化\n    $route(to, from) {\n      if (to.name == \"apply-manage\") {\n        this.getDataList();\n      }\n    }\n  }\n};\n</script>"]}]}