{"remainingRequest":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/src/views/login.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/src/views/login.vue","mtime":1579164402646},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpAaW1wb3J0ICIuL2xvZ2luLmxlc3MiOwo="},{"version":3,"sources":["login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8eA","file":"login.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"login\">\n    <Row type=\"flex\" justify=\"center\" align=\"middle\" @keydown.enter.native=\"submitLogin\">\n      <Col style=\"width: 368px;\">\n        <Header />\n        <Row v-if=\"!socialLogining\">\n          <Tabs v-model=\"tabName\">\n            <TabPane :label=\"$t('usernameLogin')\" name=\"username\" icon=\"md-person\">\n              <Form\n                ref=\"usernameLoginForm\"\n                :model=\"form\"\n                :rules=\"rules\"\n                class=\"form\"\n                v-if=\"tabName=='username'\"\n              >\n                <FormItem prop=\"username\">\n                  <Input\n                    v-model=\"form.username\"\n                    prefix=\"ios-contact\"\n                    size=\"large\"\n                    clearable\n                    placeholder=\"请输入用户名\"\n                    autocomplete=\"off\"\n                  />\n                </FormItem>\n                <FormItem prop=\"password\">\n                  <Input\n                    type=\"password\"\n                    v-model=\"form.password\"\n                    prefix=\"ios-lock\"\n                    size=\"large\"\n                    password\n                    placeholder=\"请输入密码\"\n                    autocomplete=\"off\"\n                  />\n                </FormItem>\n                <FormItem prop=\"imgCode\">\n                  <Row\n                    type=\"flex\"\n                    justify=\"space-between\"\n                    style=\"align-items: center;overflow: hidden;\"\n                  >\n                    <Input\n                      v-model=\"form.imgCode\"\n                      size=\"large\"\n                      clearable\n                      placeholder=\"请输入图片验证码\"\n                      :maxlength=\"10\"\n                      class=\"input-verify\"\n                    />\n                    <div style=\"position:relative;font-size:12px\">\n                      <Spin v-if=\"loadingCaptcha\" fix></Spin>\n                      <img\n                        :src=\"captchaImg\"\n                        @click=\"getCaptchaImg\"\n                        alt=\"加载验证码失败\"\n                        style=\"width:110px;cursor:pointer;display:block\"\n                      />\n                    </div>\n                  </Row>\n                </FormItem>\n              </Form>\n            </TabPane>\n            <TabPane :label=\"$t('mobileLogin')\" name=\"mobile\" icon=\"ios-phone-portrait\">\n              <Form\n                ref=\"mobileLoginForm\"\n                :model=\"form\"\n                :rules=\"rules\"\n                class=\"form\"\n                v-if=\"tabName=='mobile'\"\n              >\n                <FormItem prop=\"mobile\">\n                  <Input\n                    v-model=\"form.mobile\"\n                    prefix=\"ios-phone-portrait\"\n                    size=\"large\"\n                    clearable\n                    placeholder=\"请输入手机号\"\n                  />\n                </FormItem>\n                <FormItem prop=\"code\" :error=\"errorCode\">\n                  <Row type=\"flex\" justify=\"space-between\">\n                    <Input\n                      v-model=\"form.code\"\n                      prefix=\"ios-mail-outline\"\n                      size=\"large\"\n                      clearable\n                      placeholder=\"请输入短信验证码\"\n                      :maxlength=\"6\"\n                      class=\"input-verify\"\n                    />\n                    <CountDownButton\n                      ref=\"countDown\"\n                      @on-click=\"sendSmsCode\"\n                      :autoCountDown=\"false\"\n                      size=\"large\"\n                      :loading=\"sending\"\n                      :text=\"getSms\"\n                    />\n                  </Row>\n                </FormItem>\n              </Form>\n            </TabPane>\n          </Tabs>\n\n          <Row type=\"flex\" justify=\"space-between\" align=\"middle\">\n            <Checkbox v-model=\"saveLogin\" size=\"large\">{{ $t('autoLogin') }}</Checkbox>\n            <Dropdown trigger=\"click\" @on-click=\"handleDropDown\">\n              <a class=\"forget-pass\">{{ $t('forgetPass') }}</a>\n              <DropdownMenu slot=\"list\">\n                <DropdownItem name=\"showAccount\">体验测试账号</DropdownItem>\n                <DropdownItem name=\"resetByMobile\">使用手机号重置密码</DropdownItem>\n                <DropdownItem name=\"resetByEmail\">使用邮箱重置密码</DropdownItem>\n              </DropdownMenu>\n            </Dropdown>\n          </Row>\n          <Row>\n            <Button\n              class=\"login-btn\"\n              type=\"primary\"\n              size=\"large\"\n              :loading=\"loading\"\n              @click=\"submitLogin\"\n              long\n            >\n              <span v-if=\"!loading\">{{ $t('login') }}</span>\n              <span v-else>{{ $t('logining') }}</span>\n            </Button>\n          </Row>\n          <Row type=\"flex\" justify=\"space-between\" class=\"other-login\">\n            <div class=\"other-way icons\">\n              {{ $t('otherLogin') }}\n              <div class=\"other-icon\" @click=\"toGithubLogin\">\n                <icon scale=\"1.3\" name=\"brands/github\"></icon>\n              </div>\n              <div class=\"other-icon\" @click=\"toQQLogin\">\n                <icon scale=\"1.2\" name=\"brands/qq\"></icon>\n              </div>\n              <div class=\"other-icon\" @click=\"toWeixinLogin\">\n                <icon scale=\"1.3\" name=\"brands/weixin\"></icon>\n              </div>\n              <div class=\"other-icon\" @click=\"toWeiboLogin\">\n                <icon scale=\"1.3\" name=\"brands/weibo\"></icon>\n              </div>\n            </div>\n            <router-link to=\"/regist\">\n              <a class=\"forget-pass\">{{ $t('regist') }}</a>\n            </router-link>\n          </Row>\n        </Row>\n        <div v-if=\"socialLogining\">\n          <RectLoading />\n        </div>\n        <Footer />\n      </Col>\n      <LangSwitch />\n    </Row>\n  </div>\n</template>\n\n<script>\nimport {\n  login,\n  userInfo,\n  githubLogin,\n  qqLogin,\n  weiboLogin,\n  wechatLogin,\n  getJWT,\n  sendLoginSms,\n  smsLogin,\n  initCaptcha,\n  drawCodeImage,\n  getOtherSet\n} from \"@/api/index\";\nimport { validateMobile } from \"@/libs/validate\";\nimport Cookies from \"js-cookie\";\nimport Header from \"@/views/main-components/header\";\nimport Footer from \"@/views/main-components/footer\";\nimport LangSwitch from \"@/views/main-components/lang-switch\";\nimport RectLoading from \"@/views/my-components/share/rect-loading\";\nimport CountDownButton from \"@/views/my-components/share/count-down-button\";\nimport util from \"@/libs/util.js\";\nexport default {\n  components: {\n    CountDownButton,\n    RectLoading,\n    LangSwitch,\n    Header,\n    Footer\n  },\n  data() {\n    return {\n      captchaId: \"\",\n      captchaImg: \"\",\n      loadingCaptcha: true,\n      socialLogining: true,\n      error: false,\n      tabName: \"username\",\n      saveLogin: true,\n      getSms: \"获取验证码\",\n      loading: false,\n      sending: false,\n      errorCode: \"\",\n      form: {\n        username: \"test或test2 可注册 支持第三方账号登录\",\n        password: \"123456\",\n        mobile: \"阿里云短信0.045/条 若余额不足联系作者充值\",\n        code: \"\"\n      },\n      rules: {\n        username: [\n          {\n            required: true,\n            message: \"账号不能为空\",\n            trigger: \"blur\"\n          }\n        ],\n        password: [\n          {\n            required: true,\n            message: \"密码不能为空\",\n            trigger: \"blur\"\n          }\n        ],\n        imgCode: [\n          {\n            required: true,\n            message: \"验证码不能为空\",\n            trigger: \"blur\"\n          }\n        ],\n        mobile: [\n          {\n            required: true,\n            message: \"手机号不能为空\",\n            trigger: \"blur\"\n          },\n          {\n            validator: validateMobile,\n            trigger: \"blur\"\n          }\n        ]\n      }\n    };\n  },\n  methods: {\n    getCaptchaImg() {\n      this.loadingCaptcha = true;\n      initCaptcha().then(res => {\n        this.loadingCaptcha = false;\n        if (res.success) {\n          this.captchaId = res.result;\n          this.captchaImg = drawCodeImage + this.captchaId;\n        }\n      });\n    },\n    sendSmsCode() {\n      this.$refs.mobileLoginForm.validate(valid => {\n        if (valid) {\n          this.sending = true;\n          this.getSms = \"发送中\";\n          sendLoginSms(this.form.mobile).then(res => {\n            this.getSms = \"获取验证码\";\n            this.sending = false;\n            if (res.success) {\n              this.$Message.success(\"发送短信验证码成功\");\n              // 开始倒计时\n              this.$refs.countDown.startCountDown();\n            }\n          });\n        }\n      });\n    },\n    afterLogin(res) {\n      let accessToken = res.result;\n      this.setStore(\"accessToken\", accessToken);\n      getOtherSet().then(res => {\n        if (res.result) {\n          let domain = res.result.ssoDomain;\n          Cookies.set(\"accessToken\", accessToken, {\n            domain: domain,\n            expires: 7\n          });\n        }\n      });\n      // 获取用户信息\n      userInfo().then(res => {\n        if (res.success) {\n          // 避免超过大小限制\n          delete res.result.permissions;\n          let roles = [];\n          res.result.roles.forEach(e => {\n            roles.push(e.name);\n          });\n          this.setStore(\"roles\", roles);\n          this.setStore(\"saveLogin\", this.saveLogin);\n          if (this.saveLogin) {\n            // 保存7天\n            Cookies.set(\"userInfo\", JSON.stringify(res.result), {\n              expires: 7\n            });\n          } else {\n            Cookies.set(\"userInfo\", JSON.stringify(res.result));\n          }\n          this.setStore(\"userInfo\", res.result);\n          this.$store.commit(\"setAvatarPath\", res.result.avatar);\n          // 加载菜单\n          util.initRouter(this);\n          this.$router.push({\n            name: \"home_index\"\n          });\n        } else {\n          this.loading = false;\n        }\n      });\n    },\n    submitLogin() {\n      if (this.tabName == \"username\") {\n        this.$refs.usernameLoginForm.validate(valid => {\n          if (valid) {\n            this.loading = true;\n            login({\n              username: this.form.username,\n              password: this.form.password,\n              code: this.form.imgCode,\n              captchaId: this.captchaId,\n              saveLogin: this.saveLogin\n            }).then(res => {\n              if (res.success) {\n                this.afterLogin(res);\n              } else {\n                this.loading = false;\n                this.getCaptchaImg();\n              }\n            });\n          }\n        });\n      } else if (this.tabName == \"mobile\") {\n        this.$refs.mobileLoginForm.validate(valid => {\n          if (valid) {\n            if (this.form.code == \"\") {\n              this.errorCode = \"验证码不能为空\";\n              return;\n            } else {\n              this.errorCode = \"\";\n            }\n            this.loading = true;\n            this.form.saveLogin = this.saveLogin;\n            smsLogin(this.form).then(res => {\n              if (res.success) {\n                this.afterLogin(res);\n              } else {\n                this.loading = false;\n              }\n            });\n          }\n        });\n      }\n    },\n    toGithubLogin() {\n      this.socialLogining = true;\n      githubLogin().then(res => {\n        if (res.success) {\n          window.location.href = res.result;\n        } else {\n          this.socialLogining = false;\n        }\n      });\n    },\n    toQQLogin() {\n      this.socialLogining = true;\n      qqLogin().then(res => {\n        if (res.success) {\n          window.location.href = res.result;\n        } else {\n          this.socialLogining = false;\n        }\n      });\n    },\n    toWeiboLogin() {\n      this.socialLogining = true;\n      weiboLogin().then(res => {\n        if (res.success) {\n          window.location.href = res.result;\n        } else {\n          this.socialLogining = false;\n        }\n      });\n    },\n    toWeixinLogin() {\n      this.socialLogining = true;\n      wechatLogin().then(res => {\n        if (res.success) {\n          window.location.href = res.result;\n        } else {\n          this.socialLogining = false;\n        }\n      });\n    },\n    relatedLogin() {\n      let q = this.$route.query;\n      let error = q.error;\n      if (error !== \"\" && error !== undefined) {\n        this.$Message.error(error);\n      }\n      let related = q.related;\n      let JWTKey = q.JWTKey;\n      if (related && related == \"1\") {\n        if (JWTKey) {\n          getJWT({ JWTKey: JWTKey }).then(res => {\n            if (res.success) {\n              this.socialLogining = true;\n              let accessToken = res.result;\n              this.setStore(\"accessToken\", accessToken);\n              getOtherSet().then(res => {\n                if (res.result) {\n                  let domain = res.result.ssoDomain;\n                  Cookies.set(\"accessToken\", accessToken, {\n                    domain: domain,\n                    expires: 7\n                  });\n                }\n              });\n              // 获取用户信息\n              userInfo().then(res => {\n                if (res.success) {\n                  // 避免超过大小限制\n                  delete res.result.permissions;\n                  let roles = [];\n                  res.result.roles.forEach(e => {\n                    roles.push(e.name);\n                  });\n                  this.setStore(\"roles\", roles);\n                  // 保存7天\n                  Cookies.set(\"userInfo\", JSON.stringify(res.result), {\n                    expires: 7\n                  });\n                  this.setStore(\"userInfo\", res.result);\n                  this.$store.commit(\"setAvatarPath\", res.result.avatar);\n                  // 加载菜单\n                  util.initRouter(this);\n                  this.$router.push({\n                    name: \"home_index\"\n                  });\n                } else {\n                  this.socialLogining = false;\n                  this.$Message.error(\"使用第三方账号登录失败\");\n                }\n              });\n            } else {\n              this.socialLogining = false;\n              this.$Message.error(\"使用第三方账号登录失败\");\n            }\n          });\n        }\n      } else {\n        this.socialLogining = false;\n      }\n    },\n    handleDropDown(v) {\n      if (v == \"showAccount\") {\n        this.showAccount();\n      } else if (v == \"resetByMobile\") {\n        this.$router.push({\n          name: \"reset\"\n        });\n      } else if (v == \"resetByEmail\") {\n        this.$router.push({\n          name: \"reset\",\n          query: {\n            type: \"1\"\n          }\n        });\n      }\n    },\n    showAccount() {\n      this.$Notice.info({\n        title: \"体验账号密码\",\n        desc:\n          \"账号1：test 密码：123456 <br>账号2：test2 密码：123456 已开放注册！\",\n        duration: 10\n      });\n    }\n  },\n  mounted() {\n    this.showAccount();\n    this.relatedLogin();\n    this.getCaptchaImg();\n  }\n};\n</script>\n\n<style lang=\"less\">\n@import \"./login.less\";\n</style>\n"]}]}