{"remainingRequest":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/src/views/relate.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/src/views/relate.vue","mtime":1579164402669},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBDb29raWVzIGZyb20gImpzLWNvb2tpZSI7CmltcG9ydCB7IHZhcHRjaGFJRCwgcmVsYXRlLCB1c2VySW5mbywgZ2V0SldULCBnZXRPdGhlclNldCB9IGZyb20gIkAvYXBpL2luZGV4IjsKaW1wb3J0IHV0aWwgZnJvbSAiQC9saWJzL3V0aWwuanMiOwppbXBvcnQgSGVhZGVyIGZyb20gIkAvdmlld3MvbWFpbi1jb21wb25lbnRzL2hlYWRlciI7CmltcG9ydCBGb290ZXIgZnJvbSAiQC92aWV3cy9tYWluLWNvbXBvbmVudHMvZm9vdGVyIjsKaW1wb3J0IExhbmdTd2l0Y2ggZnJvbSAiQC92aWV3cy9tYWluLWNvbXBvbmVudHMvbGFuZy1zd2l0Y2giOwppbXBvcnQgUmVjdExvYWRpbmcgZnJvbSAiQC92aWV3cy9teS1jb21wb25lbnRzL3NoYXJlL3JlY3QtbG9hZGluZyI7CnZhciB2YXB0Y2hhT2JqZWN0OwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgTGFuZ1N3aXRjaCwKICAgIEhlYWRlciwKICAgIEZvb3RlciwKICAgIFJlY3RMb2FkaW5nCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgcmVsYXRlTG9hZGluZzogdHJ1ZSwKICAgICAgbG9hZGluZ1ZhcHRjaGE6IHRydWUsCiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICB2ZXJpZmllZDogZmFsc2UsCiAgICAgIGZvcm06IHsKICAgICAgICBpc0xvZ2luOiBmYWxzZSwKICAgICAgICB1c2VybmFtZTogIiIsCiAgICAgICAgcGFzc3dvcmQ6ICIiLAogICAgICAgIHNvY2lhbFR5cGU6IG51bGwsCiAgICAgICAgaWQ6ICIiLAogICAgICAgIHRva2VuOiAiIgogICAgICB9LAogICAgICBydWxlczogewogICAgICAgIHVzZXJuYW1lOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiAi6LSm5Y+35LiN6IO95Li656m6IiwKICAgICAgICAgICAgdHJpZ2dlcjogImJsdXIiCiAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICBwYXNzd29yZDogWwogICAgICAgICAgewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogIuWvhueggeS4jeiDveS4uuepuiIsCiAgICAgICAgICAgIHRyaWdnZXI6ICJibHVyIgogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfQogICAgfTsKICB9LAogIG1ldGhvZHM6IHsKICAgIHN1Ym1pdFJlbGF0ZSgpIHsKICAgICAgdGhpcy4kcmVmcy5yZWxhdGVMb2dpbkZvcm0udmFsaWRhdGUodmFsaWQgPT4gewogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuZm9ybS5pc0xvZ2luID0gZmFsc2U7CiAgICAgICAgICByZWxhdGUodGhpcy5mb3JtKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgICAgIC8vIOiOt+WPlkpXVAogICAgICAgICAgICAgIGdldEpXVCh7IEpXVEtleTogcmVzLnJlc3VsdCB9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kTWVzc2FnZS5zdWNjZXNzKCLnu5HlrprmiJDlip8iKTsKICAgICAgICAgICAgICAgICAgbGV0IGFjY2Vzc1Rva2VuID0gcmVzLnJlc3VsdDsKICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdG9yZSgiYWNjZXNzVG9rZW4iLCBhY2Nlc3NUb2tlbik7CiAgICAgICAgICAgICAgICAgIGdldE90aGVyU2V0KCkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyZXMucmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICBsZXQgZG9tYWluID0gcmVzLnJlc3VsdC5zc29Eb21haW47CiAgICAgICAgICAgICAgICAgICAgICBDb29raWVzLnNldCgiYWNjZXNzVG9rZW4iLCBhY2Nlc3NUb2tlbiwgewogICAgICAgICAgICAgICAgICAgICAgICBkb21haW46IGRvbWFpbiwKICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJlczogNwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgLy8g6I635Y+W55So5oi35L+h5oGvCiAgICAgICAgICAgICAgICAgIHVzZXJJbmZvKCkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgLy8g6YG/5YWN6LaF6L+H5aSn5bCP6ZmQ5Yi2CiAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgcmVzLnJlc3VsdC5wZXJtaXNzaW9uczsKICAgICAgICAgICAgICAgICAgICAgIGxldCByb2xlcyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgcmVzLnJlc3VsdC5yb2xlcy5mb3JFYWNoKGUgPT4gewogICAgICAgICAgICAgICAgICAgICAgICByb2xlcy5wdXNoKGUubmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RvcmUoInJvbGVzIiwgcm9sZXMpOwogICAgICAgICAgICAgICAgICAgICAgLy8g5L+d5a2YN+WkqQogICAgICAgICAgICAgICAgICAgICAgQ29va2llcy5zZXQoInVzZXJJbmZvIiwgSlNPTi5zdHJpbmdpZnkocmVzLnJlc3VsdCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJlczogNwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0b3JlKCJ1c2VySW5mbyIsIHJlcy5yZXN1bHQpOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCJzZXRBdmF0YXJQYXRoIiwgcmVzLnJlc3VsdC5hdmF0YXIpOwogICAgICAgICAgICAgICAgICAgICAgLy8g5Yqg6L296I+c5Y2VCiAgICAgICAgICAgICAgICAgICAgICB1dGlsLmluaXRSb3V0ZXIodGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICJob21lX2luZGV4IgogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICB2YXB0Y2hhT2JqZWN0LnJlc2V0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgcmVsYXRlRGlyZWN0KCkgewogICAgICAvLyDlt7LnmbvlvZUg55u05o6l57uR5a6aCiAgICAgIHRoaXMuZm9ybS5pc0xvZ2luID0gdHJ1ZTsKICAgICAgcmVsYXRlKHRoaXMuZm9ybSkudGhlbihyZXMgPT4gewogICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgdGhpcy4kTWVzc2FnZS5zdWNjZXNzKCLnu5HlrprmiJDlip8iKTsKICAgICAgICB9CiAgICAgICAgLy8g6L+U5Zue5Liq5Lq65Lit5b+DCiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgbmFtZTogIm93bnNwYWNlX2luZGV4IiwKICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgIHR5cGU6ICJzb2NpYWwiCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIGluaXRWYXB0Y2hhKCkgewogICAgICBsZXQgdGhhdCA9IHRoaXM7CiAgICAgIHZhcHRjaGEoewogICAgICAgIC8v6YWN572u5Y+C5pWwCiAgICAgICAgdmlkOiB2YXB0Y2hhSUQsIC8vIOmqjOivgeWNleWFg2lkCiAgICAgICAgdHlwZTogImludmlzaWJsZSIsIC8vIOWxleeOsOexu+WeiyDpmpDol4/lvI8KICAgICAgICBvZmZsaW5lX3NlcnZlcjogIuS9oOeahOemu+e6v+mqjOivgeaOpeWPo+WcsOWdgCDlj6/pgInkvYbmraTlpITkuI3og73kuLrnqboiCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24odmFwdGNoYU9iaikgewogICAgICAgIHZhcHRjaGFPYmplY3QgPSB2YXB0Y2hhT2JqOwogICAgICAgIGxldCB1c2VySW5mbyA9IENvb2tpZXMuZ2V0KCJ1c2VySW5mbyIpOwogICAgICAgIGlmICh1c2VySW5mbykgewogICAgICAgICAgdmFwdGNoYU9iamVjdC52YWxpZGF0ZSgpOyAvLyDlvIDlp4vpqozor4EKICAgICAgICB9CiAgICAgICAgdmFwdGNoYU9iai5saXN0ZW4oInBhc3MiLCBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoYXQuZm9ybS50b2tlbiA9IHZhcHRjaGFPYmouZ2V0VG9rZW4oKTsKICAgICAgICAgIC8vIOmqjOivgeaIkOWKnyDlj5HpgIHnu5Hlrpror7fmsYIKICAgICAgICAgIGlmICh1c2VySW5mbykgewogICAgICAgICAgICAvLyDnm7TmjqXnu5HlrpoKICAgICAgICAgICAgdGhhdC5yZWxhdGVEaXJlY3QoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOacqueZu+W9leWhq+WGmeihqOWNlee7keWumgogICAgICAgICAgICB0aGF0LnN1Ym1pdFJlbGF0ZSgpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBjaGVja1ZhcHRjaGEoKSB7CiAgICAgIHRoaXMuJHJlZnMucmVsYXRlTG9naW5Gb3JtLnZhbGlkYXRlKHZhbGlkID0+IHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIHZhcHRjaGFPYmplY3QudmFsaWRhdGUoKTsgLy8g6Iul5rKh6aqM6K+B6aqM6K+B56CBIOW8gOWni+mqjOivgQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgbGV0IHEgPSB0aGlzLiRyb3V0ZS5xdWVyeTsKICAgIHRoaXMuZm9ybS5zb2NpYWxUeXBlID0gcS5zb2NpYWxUeXBlOwogICAgdGhpcy5mb3JtLmlkID0gcS5pZDsKICAgIC8vIOWKoOi9vemqjOivgeeggQogICAgdGhpcy5pbml0VmFwdGNoYSgpOwogICAgbGV0IHVzZXJJbmZvID0gQ29va2llcy5nZXQoInVzZXJJbmZvIik7CiAgICBpZiAoIXVzZXJJbmZvKSB7CiAgICAgIHRoaXMucmVsYXRlTG9hZGluZyA9IGZhbHNlOwogICAgfQogIH0KfTsK"},{"version":3,"sources":["relate.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"relate.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"relate\">\n    <Row type=\"flex\" justify=\"center\" align=\"middle\" @keydown.enter.native=\"checkVaptcha\">\n      <Col style=\"width: 368px;\">\n        <Header />\n        <Row v-if=\"!relateLoading\">\n          <Tabs value=\"1\">\n            <TabPane label=\"绑定账号\" name=\"1\" icon=\"md-person-add\">\n              <Form ref=\"relateLoginForm\" :model=\"form\" :rules=\"rules\" class=\"form\">\n                <FormItem prop=\"username\">\n                  <Input\n                    v-model=\"form.username\"\n                    prefix=\"ios-contact\"\n                    size=\"large\"\n                    clearable\n                    placeholder=\"请输入用户名\"\n                    autocomplete=\"off\"\n                  />\n                </FormItem>\n                <FormItem prop=\"password\">\n                  <Input\n                    type=\"password\"\n                    v-model=\"form.password\"\n                    prefix=\"ios-lock\"\n                    size=\"large\"\n                    clearable\n                    placeholder=\"请输入密码\"\n                    autocomplete=\"off\"\n                  />\n                </FormItem>\n              </Form>\n            </TabPane>\n          </Tabs>\n          <Row>\n            <Button type=\"primary\" size=\"large\" :loading=\"loading\" @click=\"checkVaptcha\" long>\n              <span v-if=\"!loading\">立即绑定</span>\n              <span v-else>绑定中...</span>\n            </Button>\n          </Row>\n          <Row type=\"flex\" justify=\"space-between\" class=\"other-thing\">\n            <a @click=\"$router.go(-1)\" class=\"back\">\n              <Icon type=\"md-arrow-round-back\" style=\"margin-right:3px;\" />返回\n            </a>\n            <router-link to=\"/regist\">\n              <a class=\"back\">还没有账号？立即注册</a>\n            </router-link>\n          </Row>\n        </Row>\n        <div v-if=\"relateLoading\">\n          <RectLoading />\n        </div>\n        <Footer />\n      </Col>\n      <LangSwitch />\n    </Row>\n  </div>\n</template>\n\n<script>\nimport Cookies from \"js-cookie\";\nimport { vaptchaID, relate, userInfo, getJWT, getOtherSet } from \"@/api/index\";\nimport util from \"@/libs/util.js\";\nimport Header from \"@/views/main-components/header\";\nimport Footer from \"@/views/main-components/footer\";\nimport LangSwitch from \"@/views/main-components/lang-switch\";\nimport RectLoading from \"@/views/my-components/share/rect-loading\";\nvar vaptchaObject;\nexport default {\n  components: {\n    LangSwitch,\n    Header,\n    Footer,\n    RectLoading\n  },\n  data() {\n    return {\n      relateLoading: true,\n      loadingVaptcha: true,\n      loading: false,\n      verified: false,\n      form: {\n        isLogin: false,\n        username: \"\",\n        password: \"\",\n        socialType: null,\n        id: \"\",\n        token: \"\"\n      },\n      rules: {\n        username: [\n          {\n            required: true,\n            message: \"账号不能为空\",\n            trigger: \"blur\"\n          }\n        ],\n        password: [\n          {\n            required: true,\n            message: \"密码不能为空\",\n            trigger: \"blur\"\n          }\n        ]\n      }\n    };\n  },\n  methods: {\n    submitRelate() {\n      this.$refs.relateLoginForm.validate(valid => {\n        if (valid) {\n          this.loading = true;\n          this.form.isLogin = false;\n          relate(this.form).then(res => {\n            if (res.success) {\n              // 获取JWT\n              getJWT({ JWTKey: res.result }).then(res => {\n                if (res.success) {\n                  this.$Message.success(\"绑定成功\");\n                  let accessToken = res.result;\n                  this.setStore(\"accessToken\", accessToken);\n                  getOtherSet().then(res => {\n                    if (res.result) {\n                      let domain = res.result.ssoDomain;\n                      Cookies.set(\"accessToken\", accessToken, {\n                        domain: domain,\n                        expires: 7\n                      });\n                    }\n                  });\n                  // 获取用户信息\n                  userInfo().then(res => {\n                    if (res.success) {\n                      // 避免超过大小限制\n                      delete res.result.permissions;\n                      let roles = [];\n                      res.result.roles.forEach(e => {\n                        roles.push(e.name);\n                      });\n                      this.setStore(\"roles\", roles);\n                      // 保存7天\n                      Cookies.set(\"userInfo\", JSON.stringify(res.result), {\n                        expires: 7\n                      });\n                      this.setStore(\"userInfo\", res.result);\n                      this.$store.commit(\"setAvatarPath\", res.result.avatar);\n                      // 加载菜单\n                      util.initRouter(this);\n                      this.$router.push({\n                        name: \"home_index\"\n                      });\n                    } else {\n                      this.loading = false;\n                    }\n                  });\n                } else {\n                  this.loading = false;\n                }\n              });\n            } else {\n              this.loading = false;\n              vaptchaObject.reset();\n            }\n          });\n        }\n      });\n    },\n    relateDirect() {\n      // 已登录 直接绑定\n      this.form.isLogin = true;\n      relate(this.form).then(res => {\n        if (res.success) {\n          this.$Message.success(\"绑定成功\");\n        }\n        // 返回个人中心\n        this.$router.push({\n          name: \"ownspace_index\",\n          query: {\n            type: \"social\"\n          }\n        });\n      });\n    },\n    initVaptcha() {\n      let that = this;\n      vaptcha({\n        //配置参数\n        vid: vaptchaID, // 验证单元id\n        type: \"invisible\", // 展现类型 隐藏式\n        offline_server: \"你的离线验证接口地址 可选但此处不能为空\"\n      }).then(function(vaptchaObj) {\n        vaptchaObject = vaptchaObj;\n        let userInfo = Cookies.get(\"userInfo\");\n        if (userInfo) {\n          vaptchaObject.validate(); // 开始验证\n        }\n        vaptchaObj.listen(\"pass\", function() {\n          that.form.token = vaptchaObj.getToken();\n          // 验证成功 发送绑定请求\n          if (userInfo) {\n            // 直接绑定\n            that.relateDirect();\n          } else {\n            // 未登录填写表单绑定\n            that.submitRelate();\n          }\n        });\n      });\n    },\n    checkVaptcha() {\n      this.$refs.relateLoginForm.validate(valid => {\n        if (valid) {\n          vaptchaObject.validate(); // 若没验证验证码 开始验证\n        }\n      });\n    }\n  },\n  mounted() {\n    let q = this.$route.query;\n    this.form.socialType = q.socialType;\n    this.form.id = q.id;\n    // 加载验证码\n    this.initVaptcha();\n    let userInfo = Cookies.get(\"userInfo\");\n    if (!userInfo) {\n      this.relateLoading = false;\n    }\n  }\n};\n</script>\n\n<style lang=\"less\">\n@import \"./relate.less\";\n</style>\n"]}]}