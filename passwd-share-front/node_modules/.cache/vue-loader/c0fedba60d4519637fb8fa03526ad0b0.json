{"remainingRequest":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/src/views/sys/message-manage/addOrEditMessage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/src/views/sys/message-manage/addOrEditMessage.vue","mtime":1579164402616},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldE1lc3NhZ2VEYXRhQnlJZCwgYWRkTWVzc2FnZSwgZWRpdE1lc3NhZ2UgfSBmcm9tICJAL2FwaS9pbmRleCI7CmltcG9ydCBlZGl0b3IgZnJvbSAiQC92aWV3cy9teS1jb21wb25lbnRzL3NoYXJlL2VkaXRvciI7CmltcG9ydCB1c2VyQ2hvb3NlIGZyb20gIkAvdmlld3MvbXktY29tcG9uZW50cy9zaGFyZS91c2VyLWNob29zZSI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiYWRkX2VkaXRfbWVzc2FnZSIsCiAgY29tcG9uZW50czogewogICAgdXNlckNob29zZSwKICAgIGVkaXRvcgogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHR5cGU6IDAsCiAgICAgIGxvYWRpbmc6IGZhbHNlLCAvLyDooajljZXliqDovb3nirbmgIEKICAgICAgc2VsZWN0VXNlcnM6IFtdLAogICAgICB1c2VyTW9kYWxWaXNpYmxlOiBmYWxzZSwKICAgICAgbW9kYWxUaXRsZTogIiIsIC8vIOa3u+WKoOaIlue8lui+keagh+mimAogICAgICBmb3JtOiB7CiAgICAgICAgLy8g5re75Yqg5oiW57yW6L6R6KGo5Y2V5a+56LGh5Yid5aeL5YyW5pWw5o2uCiAgICAgICAgdGl0bGU6ICIiLAogICAgICAgIGNvbnRlbnQ6ICIiLAogICAgICAgIHR5cGU6ICIiLAogICAgICAgIHJhbmdlOiAwCiAgICAgIH0sCiAgICAgIGZvcm1WYWxpZGF0ZTogewogICAgICAgIC8vIOihqOWNlemqjOivgeinhOWImQogICAgICAgIHR5cGU6IFsKICAgICAgICAgIHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICLmtojmga/nsbvlnovkuI3og73kuLrnqboiLCB0cmlnZ2VyOiAiYmx1ciIgfQogICAgICAgIF0sCiAgICAgICAgdGl0bGU6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi5qCH6aKY5LiN6IO95Li656m6IiwgdHJpZ2dlcjogImJsdXIiIH1dLAogICAgICAgIGNvbnRlbnQ6IFt7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAi5YaF5a655LiN6IO95Li656m6IiwgdHJpZ2dlcjogImJsdXIiIH1dCiAgICAgIH0sCiAgICAgIHN1Ym1pdExvYWRpbmc6IGZhbHNlLCAvLyDmt7vliqDmiJbnvJbovpHmj5DkuqTnirbmgIEKICAgICAgZGljdE1lc3NhZ2VUeXBlOiB0aGlzLiRzdG9yZS5zdGF0ZS5kaWN0Lm1lc3NhZ2VUeXBlLAogICAgICBiYWNrUm91dGU6ICIiCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgaW5pdCgpIHsKICAgICAgdGhpcy50eXBlID0gdGhpcy4kcm91dGUucXVlcnkudHlwZTsKICAgICAgdGhpcy5iYWNrUm91dGUgPSB0aGlzLiRyb3V0ZS5xdWVyeS5iYWNrUm91dGU7CiAgICAgIGlmICh0aGlzLnR5cGUgPT0gMSkgewogICAgICAgIHRoaXMuZm9ybS5pZCA9IHRoaXMuJHJvdXRlLnF1ZXJ5LmlkOwogICAgICAgIHRoaXMuZ2V0RGF0YSgpOwogICAgICB9CiAgICB9LAogICAgZ2V0RGF0YSgpIHsKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgZ2V0TWVzc2FnZURhdGFCeUlkKHRoaXMuZm9ybS5pZCkudGhlbihyZXMgPT4gewogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgLy8g6L2s5o2ibnVsbOS4uiIiCiAgICAgICAgICBsZXQgdiA9IHJlcy5yZXN1bHQ7CiAgICAgICAgICBmb3IgKGxldCBhdHRyIGluIHYpIHsKICAgICAgICAgICAgaWYgKHZbYXR0cl0gPT0gbnVsbCkgewogICAgICAgICAgICAgIHZbYXR0cl0gPSAiIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgbGV0IHN0ciA9IEpTT04uc3RyaW5naWZ5KHYpOwogICAgICAgICAgbGV0IGRhdGEgPSBKU09OLnBhcnNlKHN0cik7CiAgICAgICAgICB0aGlzLmZvcm0gPSBkYXRhOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgaGFuZGVsU3VibWl0KCkgewogICAgICB0aGlzLiRyZWZzLmZvcm0udmFsaWRhdGUodmFsaWQgPT4gewogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgdGhpcy5zdWJtaXRMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgIGlmICh0aGlzLnR5cGUgPT0gMCkgewogICAgICAgICAgICAvLyDmt7vliqAg6YG/5YWN57yW6L6R5ZCO5Lyg5YWlaWTnrYnmlbDmja4g6K6w5b6X5Yig6ZmkCiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmZvcm0uaWQ7CiAgICAgICAgICAgIC8vIOeUqOaIt2lk5pWw5o2uCiAgICAgICAgICAgIGxldCBpZHMgPSBbXTsKICAgICAgICAgICAgdGhpcy5zZWxlY3RVc2Vycy5mb3JFYWNoKGUgPT4gewogICAgICAgICAgICAgIGlkcyArPSBlLmlkICsgIiwiOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKGlkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgaWRzID0gaWRzLnN1YnN0cmluZygwLCBpZHMubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5mb3JtLnVzZXJJZHMgPSBpZHM7CiAgICAgICAgICAgIGFkZE1lc3NhZ2UodGhpcy5mb3JtKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgdGhpcy5zdWJtaXRMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgaWYgKHJlcy5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRNZXNzYWdlLnN1Y2Nlc3MoIuaTjeS9nOaIkOWKnyIpOwogICAgICAgICAgICAgICAgdGhpcy5jbG9zZUN1cnJlbnRQYWdlKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy50eXBlID09IDEpIHsKICAgICAgICAgICAgLy8g57yW6L6RCiAgICAgICAgICAgIGVkaXRNZXNzYWdlKHRoaXMuZm9ybSkudGhlbihyZXMgPT4gewogICAgICAgICAgICAgIHRoaXMuc3VibWl0TG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgdGhpcy4kTWVzc2FnZS5zdWNjZXNzKCLmk43kvZzmiJDlip8iKTsKICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VDdXJyZW50UGFnZSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBoYW5kbGVTZWxlY3RVc2VyKHYpIHsKICAgICAgdGhpcy5zZWxlY3RVc2VycyA9IHY7CiAgICB9LAogICAgaGFuZGVsQ2FuY2VsKCkgewogICAgICB0aGlzLmNsb3NlQ3VycmVudFBhZ2UoKTsKICAgIH0sCiAgICAvLyDlhbPpl63lvZPliY3pobXpnaIKICAgIGNsb3NlQ3VycmVudFBhZ2UoKSB7CiAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgicmVtb3ZlVGFnIiwgImFkZF9lZGl0X21lc3NhZ2UiKTsKICAgICAgbG9jYWxTdG9yYWdlLnBhZ2VPcGVuZWRMaXN0ID0gSlNPTi5zdHJpbmdpZnkoCiAgICAgICAgdGhpcy4kc3RvcmUuc3RhdGUuYXBwLnBhZ2VPcGVuZWRMaXN0CiAgICAgICk7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICBuYW1lOiB0aGlzLmJhY2tSb3V0ZQogICAgICB9KTsKICAgIH0KICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmluaXQoKTsKICB9LAogIHdhdGNoOiB7CiAgICAvLyDnm5HlkKzot6/nlLHlj5jljJYKICAgICRyb3V0ZSh0bywgZnJvbSkgewogICAgICBpZiAodG8ubmFtZSA9PSAiYWRkX2VkaXRfbWVzc2FnZSIpIHsKICAgICAgICB0aGlzLnR5cGUgPSB0aGlzLiRyb3V0ZS5xdWVyeS50eXBlOwogICAgICAgIGlmICh0aGlzLnR5cGUgPT0gMSkgewogICAgICAgICAgdGhpcy5mb3JtLmlkID0gdGhpcy4kcm91dGUucXVlcnkuaWQ7CiAgICAgICAgICB0aGlzLmdldERhdGEoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["addOrEditMessage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addOrEditMessage.vue","sourceRoot":"src/views/sys/message-manage","sourcesContent":["<style lang=\"less\">\n@import \"./messageManage.less\";\n</style>\n<template>\n  <div>\n    <Card>\n      <p slot=\"title\">\n        <span v-if=\"type==0\">发送新消息</span>\n        <span v-else>编辑消息</span>\n      </p>\n      <Row>\n        <Form\n          ref=\"form\"\n          :model=\"form\"\n          :label-width=\"90\"\n          :rules=\"formValidate\"\n          style=\"position:relative\"\n        >\n          <FormItem label=\"消息类型\" prop=\"type\">\n            <Select v-model=\"form.type\" placeholder=\"请选择\" style=\"width:250px\">\n              <Option\n                v-for=\"(item, i) in dictMessageType\"\n                :key=\"i\"\n                :value=\"item.value\"\n              >{{item.title}}</Option>\n            </Select>\n          </FormItem>\n          <FormItem label=\"标题\" prop=\"title\">\n            <Input v-model=\"form.title\" style=\"width:600px\" />\n          </FormItem>\n          <FormItem label=\"内容\" prop=\"content\" class=\"wangEditor\">\n            <editor v-model=\"form.content\"></editor>\n          </FormItem>\n          <FormItem label=\"新创建账号也推送\" prop=\"createSend\">\n            <i-switch size=\"large\" v-model=\"form.createSend\">\n              <span slot=\"open\">开启</span>\n              <span slot=\"close\">关闭</span>\n            </i-switch>\n          </FormItem>\n          <div v-if=\"type==0\">\n            <FormItem label=\"发送范围\">\n              <RadioGroup v-model=\"form.range\">\n                <Radio :label=\"0\">全体用户</Radio>\n                <Radio :label=\"1\">指定用户成员</Radio>\n              </RadioGroup>\n            </FormItem>\n            <div>\n              <FormItem label=\"选择用户\" v-if=\"form.range==1\">\n                <user-choose text=\"选择发送用户\" @on-change=\"handleSelectUser\" ref=\"user\"></user-choose>\n              </FormItem>\n            </div>\n          </div>\n          <Form-item class=\"br\">\n            <Button\n              type=\"primary\"\n              :loading=\"submitLoading\"\n              @click=\"handelSubmit\"\n              style=\"width:100px\"\n            >提交</Button>\n            <Button @click=\"handelCancel\">取消</Button>\n          </Form-item>\n          <Spin size=\"large\" fix v-if=\"loading\"></Spin>\n        </Form>\n      </Row>\n    </Card>\n  </div>\n</template>\n\n<script>\nimport { getMessageDataById, addMessage, editMessage } from \"@/api/index\";\nimport editor from \"@/views/my-components/share/editor\";\nimport userChoose from \"@/views/my-components/share/user-choose\";\nexport default {\n  name: \"add_edit_message\",\n  components: {\n    userChoose,\n    editor\n  },\n  data() {\n    return {\n      type: 0,\n      loading: false, // 表单加载状态\n      selectUsers: [],\n      userModalVisible: false,\n      modalTitle: \"\", // 添加或编辑标题\n      form: {\n        // 添加或编辑表单对象初始化数据\n        title: \"\",\n        content: \"\",\n        type: \"\",\n        range: 0\n      },\n      formValidate: {\n        // 表单验证规则\n        type: [\n          { required: true, message: \"消息类型不能为空\", trigger: \"blur\" }\n        ],\n        title: [{ required: true, message: \"标题不能为空\", trigger: \"blur\" }],\n        content: [{ required: true, message: \"内容不能为空\", trigger: \"blur\" }]\n      },\n      submitLoading: false, // 添加或编辑提交状态\n      dictMessageType: this.$store.state.dict.messageType,\n      backRoute: \"\"\n    };\n  },\n  methods: {\n    init() {\n      this.type = this.$route.query.type;\n      this.backRoute = this.$route.query.backRoute;\n      if (this.type == 1) {\n        this.form.id = this.$route.query.id;\n        this.getData();\n      }\n    },\n    getData() {\n      this.loading = true;\n      getMessageDataById(this.form.id).then(res => {\n        this.loading = false;\n        if (res.success) {\n          // 转换null为\"\"\n          let v = res.result;\n          for (let attr in v) {\n            if (v[attr] == null) {\n              v[attr] = \"\";\n            }\n          }\n          let str = JSON.stringify(v);\n          let data = JSON.parse(str);\n          this.form = data;\n        }\n      });\n    },\n    handelSubmit() {\n      this.$refs.form.validate(valid => {\n        if (valid) {\n          this.submitLoading = true;\n          if (this.type == 0) {\n            // 添加 避免编辑后传入id等数据 记得删除\n            delete this.form.id;\n            // 用户id数据\n            let ids = [];\n            this.selectUsers.forEach(e => {\n              ids += e.id + \",\";\n            });\n            if (ids.length > 0) {\n              ids = ids.substring(0, ids.length - 1);\n            }\n            this.form.userIds = ids;\n            addMessage(this.form).then(res => {\n              this.submitLoading = false;\n              if (res.success) {\n                this.$Message.success(\"操作成功\");\n                this.closeCurrentPage();\n              }\n            });\n          } else if (this.type == 1) {\n            // 编辑\n            editMessage(this.form).then(res => {\n              this.submitLoading = false;\n              if (res.success) {\n                this.$Message.success(\"操作成功\");\n                this.closeCurrentPage();\n              }\n            });\n          }\n        }\n      });\n    },\n    handleSelectUser(v) {\n      this.selectUsers = v;\n    },\n    handelCancel() {\n      this.closeCurrentPage();\n    },\n    // 关闭当前页面\n    closeCurrentPage() {\n      this.$store.commit(\"removeTag\", \"add_edit_message\");\n      localStorage.pageOpenedList = JSON.stringify(\n        this.$store.state.app.pageOpenedList\n      );\n      this.$router.push({\n        name: this.backRoute\n      });\n    }\n  },\n  mounted() {\n    this.init();\n  },\n  watch: {\n    // 监听路由变化\n    $route(to, from) {\n      if (to.name == \"add_edit_message\") {\n        this.type = this.$route.query.type;\n        if (this.type == 1) {\n          this.form.id = this.$route.query.id;\n          this.getData();\n        }\n      }\n    }\n  }\n};\n</script>\n"]}]}