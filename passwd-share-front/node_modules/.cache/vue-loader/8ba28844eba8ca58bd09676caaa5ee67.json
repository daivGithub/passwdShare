{"remainingRequest":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/src/views/activiti/category-manage/categoryManage.vue?vue&type=style&index=0&lang=less&","dependencies":[{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/src/views/activiti/category-manage/categoryManage.vue","mtime":1577168504900},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/daiv/files/GitProjects/passwdShare/passwd-share-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CkBpbXBvcnQgIi4uLy4uLy4uL3N0eWxlcy90cmVlLWNvbW1vbi5sZXNzIjsKQGltcG9ydCAiLi9jYXRlZ29yeU1hbmFnZS5sZXNzIjsK"},{"version":3,"sources":["categoryManage.vue"],"names":[],"mappings":";AACA;AACA","file":"categoryManage.vue","sourceRoot":"src/views/activiti/category-manage","sourcesContent":["<style lang=\"less\">\n@import \"../../../styles/tree-common.less\";\n@import \"./categoryManage.less\";\n</style>\n<template>\n  <div class=\"search\">\n    <Card>\n      <Row class=\"operation\">\n        <Button @click=\"add\" type=\"primary\" icon=\"md-add\">添加子类别</Button>\n        <Button @click=\"addRoot\" icon=\"md-add\">添加一级类别</Button>\n        <Button @click=\"delAll\" icon=\"md-trash\">批量删除</Button>\n        <Button @click=\"getParentList\" icon=\"md-refresh\">刷新</Button>\n        <i-switch v-model=\"strict\" size=\"large\" style=\"margin-left:5px\">\n          <span slot=\"open\">级联</span>\n          <span slot=\"close\">单选</span>\n        </i-switch>\n      </Row>\n      <Row type=\"flex\" justify=\"start\">\n        <Col :md=\"8\" :lg=\"8\" :xl=\"6\">\n          <Alert show-icon>\n            当前选择编辑：\n            <span class=\"select-title\">{{editTitle}}</span>\n            <a class=\"select-clear\" v-if=\"form.id\" @click=\"cancelEdit\">取消选择</a>\n          </Alert>\n          <Input\n            v-model=\"searchKey\"\n            suffix=\"ios-search\"\n            @on-change=\"search\"\n            placeholder=\"输入节点名搜索\"\n            clearable\n          />\n          <div class=\"tree-bar\">\n            <Tree\n              ref=\"tree\"\n              :data=\"data\"\n              :load-data=\"loadData\"\n              :render=\"renderContent\"\n              show-checkbox\n              @on-check-change=\"changeSelect\"\n              @on-select-change=\"selectTree\"\n              :check-strictly=\"!strict\"\n            ></Tree>\n            <Spin size=\"large\" fix v-if=\"loading\"></Spin>\n          </div>\n        </Col>\n        <Col :md=\"15\" :lg=\"13\" :xl=\"9\" style=\"margin-left:10px;\">\n          <Form ref=\"form\" :model=\"form\" :label-width=\"85\" :rules=\"formValidate\">\n            <FormItem label=\"上级节点\" prop=\"parentTitle\">\n              <div style=\"display:flex;\">\n                <Input v-model=\"form.parentTitle\" readonly style=\"margin-right:10px;\" />\n                <Poptip transfer trigger=\"click\" placement=\"right-start\" title=\"选择上级节点\" width=\"250\">\n                  <Button icon=\"md-list\">选择分类</Button>\n                  <div slot=\"content\" style=\"position:relative;min-height:5vh\">\n                    <Tree :data=\"dataEdit\" :load-data=\"loadData\" @on-select-change=\"selectTreeEdit\"></Tree>\n                    <Spin size=\"large\" fix v-if=\"loadingEdit\"></Spin>\n                  </div>\n                </Poptip>\n              </div>\n            </FormItem>\n            <FormItem label=\"节点类型\" prop=\"type\">\n              <Select v-model=\"form.type\" placeholder=\"请选择\" clearable>\n                <Option value=\"0\">分组</Option>\n                <Option value=\"1\">类别</Option>\n              </Select>\n            </FormItem>\n            <FormItem label=\"类别名称\" prop=\"title\">\n              <Input v-model=\"form.title\" />\n            </FormItem>\n            <FormItem label=\"排序值\" prop=\"sortOrder\">\n              <Tooltip trigger=\"hover\" placement=\"right\" content=\"值越小越靠前，支持小数\">\n                <InputNumber :max=\"1000\" :min=\"0\" v-model=\"form.sortOrder\"></InputNumber>\n              </Tooltip>\n            </FormItem>\n            <FormItem label=\"是否启用\" prop=\"status\">\n              <i-switch size=\"large\" v-model=\"form.status\" :true-value=\"0\" :false-value=\"-1\">\n                <span slot=\"open\">启用</span>\n                <span slot=\"close\">禁用</span>\n              </i-switch>\n            </FormItem>\n            <Form-item>\n              <Button\n                style=\"margin-right:5px\"\n                @click=\"submitEdit\"\n                :loading=\"submitLoading\"\n                type=\"primary\"\n                icon=\"ios-create-outline\"\n              >修改并保存</Button>\n              <Button @click=\"handleReset\">重置</Button>\n            </Form-item>\n          </Form>\n        </Col>\n      </Row>\n    </Card>\n\n    <Modal :title=\"modalTitle\" v-model=\"modalVisible\" :mask-closable=\"false\" :width=\"500\">\n      <Form ref=\"formAdd\" :model=\"formAdd\" :label-width=\"85\" :rules=\"formValidate\">\n        <div v-if=\"showParent\">\n          <FormItem label=\"上级节点：\">{{form.title}}</FormItem>\n        </div>\n        <FormItem label=\"节点类型\" prop=\"type\">\n          <Select v-model=\"formAdd.type\" placeholder=\"请选择\" clearable>\n            <Option value=\"0\">分组</Option>\n            <Option value=\"1\">类别</Option>\n          </Select>\n        </FormItem>\n        <FormItem label=\"类别名称\" prop=\"title\">\n          <Input v-model=\"formAdd.title\" />\n        </FormItem>\n        <FormItem label=\"排序值\" prop=\"sortOrder\">\n          <Tooltip trigger=\"hover\" placement=\"right\" content=\"值越小越靠前，支持小数\">\n            <InputNumber :max=\"1000\" :min=\"0\" v-model=\"formAdd.sortOrder\"></InputNumber>\n          </Tooltip>\n        </FormItem>\n        <FormItem label=\"是否启用\" prop=\"status\">\n          <i-switch size=\"large\" v-model=\"formAdd.status\" :true-value=\"0\" :false-value=\"-1\">\n            <span slot=\"open\">启用</span>\n            <span slot=\"close\">禁用</span>\n          </i-switch>\n        </FormItem>\n      </Form>\n      <div slot=\"footer\">\n        <Button type=\"text\" @click=\"cancelAdd\">取消</Button>\n        <Button type=\"primary\" :loading=\"submitLoading\" @click=\"submitAdd\">提交</Button>\n      </div>\n    </Modal>\n  </div>\n</template>\n\n<script>\nimport {\n  initActCategory,\n  loadActCategory,\n  addActCategory,\n  editActCategory,\n  deleteActCategory,\n  searchActCategory\n} from \"@/api/activiti\";\nexport default {\n  name: \"category-manage\",\n  data() {\n    return {\n      strict: true,\n      loading: true,\n      loadingEdit: true,\n      modalVisible: false,\n      selectList: [],\n      selectCount: 0,\n      showParent: false,\n      modalTitle: \"\",\n      editTitle: \"\",\n      searchKey: \"\",\n      form: {\n        id: \"\",\n        title: \"\",\n        parentId: \"\",\n        parentTitle: \"\",\n        type: null,\n        sortOrder: 0,\n        status: 0,\n        url: \"\"\n      },\n      formAdd: {\n        type: null\n      },\n      formValidate: {\n        title: [{ required: true, message: \"名称不能为空\", trigger: \"blur\" }],\n        type: [{ required: true, message: \"类型不能为空\", trigger: \"blur\" }],\n        sortOrder: [\n          {\n            required: true,\n            type: \"number\",\n            message: \"排序值不能为空\",\n            trigger: \"blur\"\n          }\n        ]\n      },\n      submitLoading: false,\n      data: [],\n      dataEdit: []\n    };\n  },\n  methods: {\n    init() {\n      this.getParentList();\n      this.getParentListEdit();\n    },\n    renderContent(h, { root, node, data }) {\n      let icon = \"\";\n      if (data.type == \"0\") {\n        icon = \"md-folder-open\";\n      } else if (data.type == \"1\") {\n        icon = \"ios-bookmark-outline\";\n      }\n      return h(\n        \"span\",\n        {\n          style: {\n            display: \"inline-block\",\n            cursor: \"pointer\"\n          },\n          on: {\n            click: () => {\n              this.selectTree(data);\n            }\n          }\n        },\n        [\n          h(\"span\", [\n            h(\"Icon\", {\n              props: {\n                type: icon,\n                size: \"16\"\n              },\n              style: {\n                \"margin-right\": \"8px\",\n                \"margin-bottom\": \"3px\"\n              }\n            }),\n            h(\n              \"span\",\n              {\n                class: {\n                  \"ivu-tree-title\": true,\n                  \"ivu-tree-title-selected\": data.id == this.form.id\n                }\n              },\n              data.title\n            )\n          ])\n        ]\n      );\n    },\n    getParentList() {\n      this.loading = true;\n      initActCategory().then(res => {\n        this.loading = false;\n        if (res.success) {\n          res.result.forEach(function(e) {\n            if (e.isParent) {\n              e.loading = false;\n              e.children = [];\n            }\n          });\n          this.data = res.result;\n        }\n      });\n    },\n    getParentListEdit() {\n      this.loadingEdit = true;\n      initActCategory().then(res => {\n        this.loadingEdit = false;\n        if (res.success) {\n          res.result.forEach(function(e) {\n            if (e.isParent) {\n              e.loading = false;\n              e.children = [];\n            }\n          });\n          // 头部加入一级\n          let first = {\n            id: \"0\",\n            title: \"一级节点\"\n          };\n          res.result.unshift(first);\n          this.dataEdit = res.result;\n        }\n      });\n    },\n    loadData(item, callback) {\n      loadActCategory(item.id).then(res => {\n        if (res.success) {\n          res.result.forEach(function(e) {\n            if (e.isParent) {\n              e.loading = false;\n              e.children = [];\n            }\n          });\n          callback(res.result);\n        }\n      });\n    },\n    search() {\n      if (this.searchKey) {\n        this.loading = true;\n        searchActCategory({ title: this.searchKey }).then(res => {\n          this.loading = false;\n          if (res.success) {\n            this.data = res.result;\n          }\n        });\n      } else {\n        this.getParentList();\n      }\n    },\n    selectTree(v) {\n      if (v && v.id != this.form.id) {\n        // 转换null为\"\"\n        for (let attr in v) {\n          if (v[attr] == null) {\n            v[attr] = \"\";\n          }\n        }\n        let str = JSON.stringify(v);\n        let data = JSON.parse(str);\n        data.type += \"\";\n        this.form = data;\n        this.editTitle = data.title;\n      } else {\n        this.cancelEdit();\n      }\n    },\n    cancelEdit() {\n      let data = this.$refs.tree.getSelectedNodes()[0];\n      if (data) {\n        data.selected = false;\n      }\n      this.$refs.form.resetFields();\n      this.form.id = \"\";\n      delete this.form.id;\n      this.editTitle = \"\";\n    },\n    selectTreeEdit(v) {\n      if (v) {\n        // 转换null为\"\"\n        for (let attr in v[0]) {\n          if (v[0][attr] == null) {\n            v[0][attr] = \"\";\n          }\n        }\n        let str = JSON.stringify(v[0]);\n        let data = JSON.parse(str);\n        this.form.parentId = data.id;\n        this.form.parentTitle = data.title;\n      }\n    },\n    cancelAdd() {\n      this.modalVisible = false;\n    },\n    handleReset() {\n      this.$refs.form.resetFields();\n      this.form.status = 0;\n    },\n    submitEdit() {\n      this.$refs.form.validate(valid => {\n        if (valid) {\n          if (!this.form.id) {\n            this.$Message.warning(\"请先点击选择要修改的节点\");\n            return;\n          }\n          this.submitLoading = true;\n          editActCategory(this.form).then(res => {\n            this.submitLoading = false;\n            if (res.success) {\n              this.$Message.success(\"编辑成功\");\n              this.init();\n              this.modalVisible = false;\n            }\n          });\n        }\n      });\n    },\n    submitAdd() {\n      this.$refs.formAdd.validate(valid => {\n        if (valid) {\n          this.submitLoading = true;\n          addActCategory(this.formAdd).then(res => {\n            this.submitLoading = false;\n            if (res.success) {\n              this.$Message.success(\"添加成功\");\n              this.init();\n              this.modalVisible = false;\n            }\n          });\n        }\n      });\n    },\n    add() {\n      if (this.form.id == \"\" || this.form.id == null) {\n        this.$Message.warning(\"请先点击选择一个节点\");\n        return;\n      }\n      this.modalTitle = \"添加子类别\";\n      this.showParent = true;\n      this.formAdd = {\n        parentId: this.form.id,\n        sortOrder: 0,\n        status: 0,\n        type: null\n      };\n      this.modalVisible = true;\n    },\n    addRoot() {\n      this.modalTitle = \"添加一级类别\";\n      this.showParent = false;\n      this.formAdd = {\n        parentId: 0,\n        sortOrder: 0,\n        status: 0,\n        type: null\n      };\n      this.modalVisible = true;\n    },\n    changeSelect(v) {\n      this.selectCount = v.length;\n      this.selectList = v;\n    },\n    delAll() {\n      if (this.selectCount <= 0) {\n        this.$Message.warning(\"您还未勾选要删除的数据\");\n        return;\n      }\n      this.$Modal.confirm({\n        title: \"确认删除\",\n        content:\n          \"您确认要删除所选的 \" + this.selectCount + \" 条数据及其下级所有数据?\",\n        loading: true,\n        onOk: () => {\n          let ids = \"\";\n          this.selectList.forEach(function(e) {\n            ids += e.id + \",\";\n          });\n          ids = ids.substring(0, ids.length - 1);\n          deleteActCategory(ids).then(res => {\n            this.$Modal.remove();\n            if (res.success) {\n              this.$Message.success(\"删除成功\");\n              this.selectList = [];\n              this.selectCount = 0;\n              this.cancelEdit();\n              this.init();\n            }\n          });\n        }\n      });\n    }\n  },\n  mounted() {\n    this.init();\n  }\n};\n</script>"]}]}